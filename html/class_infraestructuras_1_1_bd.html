<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Referencia de la Clase Infraestructuras\Bd</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generado por Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Buscar','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Buscar');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_infraestructuras.html">Infraestructuras</a></li><li class="navelem"><a class="el" href="class_infraestructuras_1_1_bd.html">Bd</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Métodos públicos</a> &#124;
<a href="class_infraestructuras_1_1_bd-members.html">Lista de todos los miembros</a>  </div>
  <div class="headertitle"><div class="title">Referencia de la Clase Infraestructuras\Bd</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Métodos públicos</h2></td></tr>
<tr class="memitem:a06f2b719fa5c264bdeb54d89e20fe7c3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#a06f2b719fa5c264bdeb54d89e20fe7c3">__construct</a> ()</td></tr>
<tr class="separator:a06f2b719fa5c264bdeb54d89e20fe7c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1876f8a3d203fc06ed2cc11f89a419c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#ae1876f8a3d203fc06ed2cc11f89a419c">agregarModificarDatosBD</a> ($sentencia, $datos)</td></tr>
<tr class="separator:ae1876f8a3d203fc06ed2cc11f89a419c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefaca3514b9f8d12b9b02141e5eb5cd5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#aefaca3514b9f8d12b9b02141e5eb5cd5">agregarModDatosNumTransaction</a> ($sentencias, $datos)</td></tr>
<tr class="separator:aefaca3514b9f8d12b9b02141e5eb5cd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f361d02d50785e43cf84eaeb064a521"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#a6f361d02d50785e43cf84eaeb064a521">iniciarTransaccionManual</a> ()</td></tr>
<tr class="separator:a6f361d02d50785e43cf84eaeb064a521"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1917ca456e4b156e5fd689f5133bd21b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#a1917ca456e4b156e5fd689f5133bd21b">agregarModificarDatosBDNum</a> ($sentencia, $datos, $pdo=&quot;&quot;)</td></tr>
<tr class="separator:a1917ca456e4b156e5fd689f5133bd21b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f1ba034ae9de43dea72594438732cef"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#a3f1ba034ae9de43dea72594438732cef">recuperDatosBD</a> ($sentencia, $datos=[])</td></tr>
<tr class="separator:a3f1ba034ae9de43dea72594438732cef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10e5c8f21b891ea8b624264fa8a14125"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#a10e5c8f21b891ea8b624264fa8a14125">recuperarDatosBDNum</a> ($sentencia, $datos=[], $pdo=&quot;&quot;)</td></tr>
<tr class="separator:a10e5c8f21b891ea8b624264fa8a14125"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5f6e97a847540c659d25aedcd2b4f8d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#ae5f6e97a847540c659d25aedcd2b4f8d">registrarUsuario</a> ($datosUsuario, $datosOblig, $fichero)</td></tr>
<tr class="separator:ae5f6e97a847540c659d25aedcd2b4f8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6d7ab43437e9d1bae4d91b7d09efe76"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#aa6d7ab43437e9d1bae4d91b7d09efe76">loginUsuario</a> ($datosUsuario)</td></tr>
<tr class="separator:aa6d7ab43437e9d1bae4d91b7d09efe76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6183277a3e067c08329238cbc1da56de"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#a6183277a3e067c08329238cbc1da56de">gestionarFichero</a> ($fichero, $carpetaFichero)</td></tr>
<tr class="separator:a6183277a3e067c08329238cbc1da56de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae33e84d105db2a7a144af2e6f43e7a47"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#ae33e84d105db2a7a144af2e6f43e7a47">comprobarUsuario</a> ($usuario)</td></tr>
<tr class="separator:ae33e84d105db2a7a144af2e6f43e7a47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a576f15daee9e501398c9529542dfc94e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#a576f15daee9e501398c9529542dfc94e">cargarGeneros</a> ()</td></tr>
<tr class="separator:a576f15daee9e501398c9529542dfc94e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1bff4b22872876a8d86f8ff3b52454f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#ac1bff4b22872876a8d86f8ff3b52454f">codificarArrayUtf8</a> (&amp;$array)</td></tr>
<tr class="separator:ac1bff4b22872876a8d86f8ff3b52454f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24df5b2a2836073d9559f23a91fcdc7e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#a24df5b2a2836073d9559f23a91fcdc7e">cargarCajasSorpresa</a> ($numCajas)</td></tr>
<tr class="separator:a24df5b2a2836073d9559f23a91fcdc7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0847d581eaf3e864bd5f09baedb45720"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_infraestructuras_1_1_bd.html#a0847d581eaf3e864bd5f09baedb45720">ultimoProducto</a> ($numProd)</td></tr>
<tr class="separator:a0847d581eaf3e864bd5f09baedb45720"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Descripción detallada</h2>
<div class="textblock"><p >Clase con los métodos de tipo estático para la manipulación de la BD </p>
</div><h2 class="groupheader">Documentación del constructor y destructor</h2>
<a id="a06f2b719fa5c264bdeb54d89e20fe7c3" name="a06f2b719fa5c264bdeb54d89e20fe7c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06f2b719fa5c264bdeb54d89e20fe7c3">&#9670;&nbsp;</a></span>__construct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::__construct </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Asigna el valor a los ficheros ya que se forma a partir de funciones por lo que no pueden ser constantes que se inicialicen </p>
<div class="fragment"><div class="line"><span class="lineno">   37</span>                          {</div>
<div class="line"><span class="lineno">   38</span>        $this-&gt;ficheroConf = dirname(__FILE__, 3) . DIRECTORY_SEPARATOR . <span class="stringliteral">&quot;config&quot;</span> . DIRECTORY_SEPARATOR . <span class="stringliteral">&quot;xmlConfig.xml&quot;</span>;</div>
<div class="line"><span class="lineno">   39</span>        $this-&gt;ficheroConfValidar = dirname(__FILE__, 3) . DIRECTORY_SEPARATOR  . <span class="stringliteral">&quot;config&quot;</span> . DIRECTORY_SEPARATOR . <span class="stringliteral">&quot;xmlConfig.xsd&quot;</span>;</div>
<div class="line"><span class="lineno">   40</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Documentación de las funciones miembro</h2>
<a id="aefaca3514b9f8d12b9b02141e5eb5cd5" name="aefaca3514b9f8d12b9b02141e5eb5cd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefaca3514b9f8d12b9b02141e5eb5cd5">&#9670;&nbsp;</a></span>agregarModDatosNumTransaction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::agregarModDatosNumTransaction </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$sentencias</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Ejecuta diversas funciones en una transacción</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$sentencias</td><td>Array de sentencias a ejecutar </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$datos</td><td>Array con los datos a asignar</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>mixed Puede devolver error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  139</span>                                                                       {</div>
<div class="line"><span class="lineno">  140</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  141</span>            <span class="comment">//Creamos la conexión</span></div>
<div class="line"><span class="lineno">  142</span>            $pdo = $this-&gt;conectarBD();</div>
<div class="line"><span class="lineno">  143</span>            <span class="comment">//Iniciamos la transacción</span></div>
<div class="line"><span class="lineno">  144</span>            $pdo-&gt;beginTransaction();</div>
<div class="line"><span class="lineno">  145</span>            <span class="comment">//Recorremos las sentencias y vamos ejecutándolas</span></div>
<div class="line"><span class="lineno">  146</span>            <span class="keywordflow">for</span> ($i = 0; $i &lt; count($sentencias); $i++){</div>
<div class="line"><span class="lineno">  147</span>                $pdoStatement = $pdo-&gt;prepare($sentencias[$i]);</div>
<div class="line"><span class="lineno">  148</span>                <span class="keywordflow">if</span>(!$pdoStatement){</div>
<div class="line"><span class="lineno">  149</span>                    <span class="keywordflow">throw</span> new \PDOException($pdo-&gt;errorInfo()[2]);</div>
<div class="line"><span class="lineno">  150</span>                }</div>
<div class="line"><span class="lineno">  151</span>                <span class="comment">//asignamos los datos</span></div>
<div class="line"><span class="lineno">  152</span>                <span class="keywordflow">foreach</span>(<a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a>[$i] as $indice =&gt; $valor) {</div>
<div class="line"><span class="lineno">  153</span>                    $dato = is_string($valor) ? \PDO::PARAM_STR : \PDO::PARAM_INT;</div>
<div class="line"><span class="lineno">  154</span>                    $pdoStatement-&gt;bindParam(<span class="stringliteral">&quot;:&quot;</span> . $indice, $valor, $dato);</div>
<div class="line"><span class="lineno">  155</span>                    <span class="comment">//Eliminamos el $indice y valor para que no de errores</span></div>
<div class="line"><span class="lineno">  156</span>                    unset($indice);</div>
<div class="line"><span class="lineno">  157</span>                    unset($valor);</div>
<div class="line"><span class="lineno">  158</span>                }</div>
<div class="line"><span class="lineno">  159</span>                <span class="comment">//Lo ejecutamos</span></div>
<div class="line"><span class="lineno">  160</span>                <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $pdoStatement-&gt;execute();</div>
<div class="line"><span class="lineno">  161</span>                <span class="keywordflow">if</span>(!<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>){</div>
<div class="line"><span class="lineno">  162</span>                    <span class="keywordflow">throw</span> new \PDOException($pdoStatement-&gt;errorInfo()[2]);</div>
<div class="line"><span class="lineno">  163</span>                }</div>
<div class="line"><span class="lineno">  164</span>            }</div>
<div class="line"><span class="lineno">  165</span>            <span class="comment">//Si llegamos hasta aquí es que se ejecutó todo</span></div>
<div class="line"><span class="lineno">  166</span>            $pdo-&gt;commit();</div>
<div class="line"><span class="lineno">  167</span>        }</div>
<div class="line"><span class="lineno">  168</span>        <span class="comment">//Ambos try catch devuelve el error para mostrarlo por pantalla y poder solucionarlo, cuando lo acabemos quitaremos la muestra de los errores, esto es sólo para desarrollo</span></div>
<div class="line"><span class="lineno">  169</span>        <span class="keywordflow">catch</span>(\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  170</span>            $pdo-&gt;rollBack();</div>
<div class="line"><span class="lineno">  171</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  172</span>        }</div>
<div class="line"><span class="lineno">  173</span>        <span class="keywordflow">catch</span>(\Exception $error) {</div>
<div class="line"><span class="lineno">  174</span>            $pdo-&gt;rollBack();</div>
<div class="line"><span class="lineno">  175</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  176</span>        }</div>
<div class="line"><span class="lineno">  177</span>    }</div>
<div class="ttc" id="aregistro_8php_html_a8a19dd5c98c023a74c45bfbed55e9674"><div class="ttname"><a href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a></div><div class="ttdeci">$datos</div><div class="ttdef"><b>Definition:</b> registro.php:6</div></div>
<div class="ttc" id="asuscripciones_8php_html_a06face0ef35c41554d8f4fe115363f58"><div class="ttname"><a href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a></div><div class="ttdeci">$resultado</div><div class="ttdef"><b>Definition:</b> suscripciones.php:83</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae1876f8a3d203fc06ed2cc11f89a419c" name="ae1876f8a3d203fc06ed2cc11f89a419c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1876f8a3d203fc06ed2cc11f89a419c">&#9670;&nbsp;</a></span>agregarModificarDatosBD()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::agregarModificarDatosBD </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$sentencia</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Método para realizar insert, update o delete (Estático)</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$sentencia</td><td>Sentencia de la BD a ejecutar </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$datos</td><td>Array con los parámetros a asignar en la función preparada</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>boolean Puede devolver true si se realizó con éxito o false si hubo un error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  108</span>                                                               {</div>
<div class="line"><span class="lineno">  109</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  110</span>            <span class="comment">//Creo la conexión</span></div>
<div class="line"><span class="lineno">  111</span>            $pdo = $this-&gt;conectarBD();</div>
<div class="line"><span class="lineno">  112</span>            <span class="comment">//Ejecutamos la sentencia</span></div>
<div class="line"><span class="lineno">  113</span>            $pdoStatement = $pdo-&gt;prepare($sentencia);</div>
<div class="line"><span class="lineno">  114</span>            <span class="comment">//Ejecutamos y asignamos las variables a la vez</span></div>
<div class="line"><span class="lineno">  115</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $pdoStatement-&gt;execute(array_values(<a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a>));</div>
<div class="line"><span class="lineno">  116</span>            <span class="keywordflow">if</span>(!<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>){</div>
<div class="line"><span class="lineno">  117</span>                <span class="keywordflow">throw</span> new \PDOException($pdoStatement-&gt;errorInfo()[2]);</div>
<div class="line"><span class="lineno">  118</span>            }</div>
<div class="line"><span class="lineno">  119</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $pdo-&gt;lastInsertId();</div>
<div class="line"><span class="lineno">  120</span>        }</div>
<div class="line"><span class="lineno">  121</span>        <span class="comment">//Ambos try catch devuelve el error para mostrarlo por pantalla y poder solucionarlo, cuando lo acabemos quitaremos la muestra de los errores, esto es sólo para desarrollo</span></div>
<div class="line"><span class="lineno">  122</span>        <span class="keywordflow">catch</span>(\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  123</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  124</span>        }</div>
<div class="line"><span class="lineno">  125</span>        <span class="keywordflow">catch</span>(\Exception $error) {</div>
<div class="line"><span class="lineno">  126</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  127</span>        }</div>
<div class="line"><span class="lineno">  128</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>;</div>
<div class="line"><span class="lineno">  129</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1917ca456e4b156e5fd689f5133bd21b" name="a1917ca456e4b156e5fd689f5133bd21b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1917ca456e4b156e5fd689f5133bd21b">&#9670;&nbsp;</a></span>agregarModificarDatosBDNum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::agregarModificarDatosBDNum </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$sentencia</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pdo</em> = <code>&quot;&quot;</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Método para realizar insert, update o delete (Estático)</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$sentencia</td><td>Sentencia de la BD a ejecutar </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$datos</td><td>Array con los parámetros a asignar en la función preparada </td></tr>
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Elemento PDO que usamos en una transaccion manual</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>mixed Devuelve el id o error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  201</span>                                                                             {</div>
<div class="line"><span class="lineno">  202</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  203</span>            <span class="keywordflow">if</span>($pdo == <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><span class="lineno">  204</span>                <span class="comment">//Creo la conexión</span></div>
<div class="line"><span class="lineno">  205</span>                $pdo = $this-&gt;conectarBD();</div>
<div class="line"><span class="lineno">  206</span>            }</div>
<div class="line"><span class="lineno">  207</span>            <span class="comment">//Ejecutamos la sentencia</span></div>
<div class="line"><span class="lineno">  208</span>            $pdoStatement = $pdo-&gt;prepare($sentencia);</div>
<div class="line"><span class="lineno">  209</span>            <span class="comment">//Asignamos los valores</span></div>
<div class="line"><span class="lineno">  210</span>            <span class="keywordflow">foreach</span>(<a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a> as $indice =&gt; $valor){</div>
<div class="line"><span class="lineno">  211</span>                $tipoDato = is_string($valor) ? \PDO::PARAM_STR : \PDO::PARAM_INT;</div>
<div class="line"><span class="lineno">  212</span>                $pdoStatement-&gt;bindParam(<span class="stringliteral">&quot;:&quot;</span> . $indice, $valor, $tipoDato);</div>
<div class="line"><span class="lineno">  213</span>                <span class="comment">//Limpiamos $indice o valor sino da error para los datos a partir del primero</span></div>
<div class="line"><span class="lineno">  214</span>                unset($indice);</div>
<div class="line"><span class="lineno">  215</span>                unset($valor);</div>
<div class="line"><span class="lineno">  216</span>            }</div>
<div class="line"><span class="lineno">  217</span>            <span class="comment">//Ejecutamos y asignamos las variables a la vez</span></div>
<div class="line"><span class="lineno">  218</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $pdoStatement-&gt;execute();</div>
<div class="line"><span class="lineno">  219</span>            <span class="keywordflow">if</span>(!<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>){</div>
<div class="line"><span class="lineno">  220</span>                <span class="keywordflow">throw</span> new \PDOException($pdoStatement-&gt;errorInfo()[2]);</div>
<div class="line"><span class="lineno">  221</span>            }</div>
<div class="line"><span class="lineno">  222</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $pdo-&gt;lastInsertId();</div>
<div class="line"><span class="lineno">  223</span>        }</div>
<div class="line"><span class="lineno">  224</span>        <span class="comment">//Ambos try catch devuelve el error para mostrarlo por pantalla y poder solucionarlo, cuando lo acabemos quitaremos la muestra de los errores, esto es sólo para desarrollo</span></div>
<div class="line"><span class="lineno">  225</span>        <span class="keywordflow">catch</span>(\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  226</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  227</span>        }</div>
<div class="line"><span class="lineno">  228</span>        <span class="keywordflow">catch</span>(\Exception $error) {</div>
<div class="line"><span class="lineno">  229</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  230</span>        }</div>
<div class="line"><span class="lineno">  231</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>;</div>
<div class="line"><span class="lineno">  232</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a24df5b2a2836073d9559f23a91fcdc7e" name="a24df5b2a2836073d9559f23a91fcdc7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24df5b2a2836073d9559f23a91fcdc7e">&#9670;&nbsp;</a></span>cargarCajasSorpresa()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::cargarCajasSorpresa </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$numCajas</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Carga las $numCajas cajas sorpresa</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramname">[type]</td><td>$numCajas [$numCajas description]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>[type] [return description] </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  566</span>                                                   {</div>
<div class="line"><span class="lineno">  567</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  568</span>            <span class="comment">//Sentencia para coger los id de las 3 últimas cajas</span></div>
<div class="line"><span class="lineno">  569</span>            $sentenciaCajas = <span class="stringliteral">&quot;SELECT id_caja FROM cajas_sorpresa WHERE fecha &lt; (NOW() - INTERVAL DAYOFMONTH(NOW()) - 1 DAY) LIMIT 0, :numCajas;&quot;</span>;</div>
<div class="line"><span class="lineno">  570</span>            <span class="comment">//La prepraramos ya que la ejecutaremos varias veces</span></div>
<div class="line"><span class="lineno">  571</span>            $pdoStatement = $this-&gt;<a class="code hl_function" href="class_infraestructuras_1_1_bd.html#a10e5c8f21b891ea8b624264fa8a14125">recuperarDatosBDNum</a>($sentenciaCajas, [<span class="stringliteral">&quot;numCajas&quot;</span> =&gt; $numCajas]);</div>
<div class="line"><span class="lineno">  572</span>            <span class="comment">//Array donde guardaremos los datos de las cajas</span></div>
<div class="line"><span class="lineno">  573</span>            $datosCajas = [];</div>
<div class="line"><span class="lineno">  574</span>            <span class="comment">//Comprobamos que no diera error</span></div>
<div class="line"><span class="lineno">  575</span>            <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement) {</div>
<div class="line"><span class="lineno">  576</span>                <span class="keywordflow">throw</span> <span class="keyword">new</span> PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  577</span>            }</div>
<div class="line"><span class="lineno">  578</span>            <span class="comment">//Cargamos los tres resultados (como mucho)</span></div>
<div class="line"><span class="lineno">  579</span>            $cajas = $pdoStatement-&gt;fetchAll(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  580</span>            <span class="comment">//Recorremos cada una de las cajas para añadirlo a la sentencia</span></div>
<div class="line"><span class="lineno">  581</span>            <span class="keywordflow">foreach</span>($cajas as $id){</div>
<div class="line"><span class="lineno">  582</span>                <span class="comment">//Sentencia que ejecutaremos</span></div>
<div class="line"><span class="lineno">  583</span>                $sentencia = <span class="stringliteral">&quot;SELECT CS.img_caja, CS.fecha, P.nombre, P.imagen_producto FROM cajas_sorpresa AS CS INNER JOIN cajas_sorpresa_producto as CP ON CS.id_caja = :id_caja AND CS.id_caja = CP.caja_sorpresa INNER JOIN productos as P ON CP.producto = P.id_producto LIMIT 0, 4;&quot;</span>;</div>
<div class="line"><span class="lineno">  584</span>                <span class="comment">//Como vamos a ejecutarla con frecuencia preparamos la sentencia</span></div>
<div class="line"><span class="lineno">  585</span>                $pdoStatement = $this-&gt;<a class="code hl_function" href="class_infraestructuras_1_1_bd.html#a3f1ba034ae9de43dea72594438732cef">recuperDatosBD</a>($sentencia, $id);</div>
<div class="line"><span class="lineno">  586</span>                <span class="comment">//Comprobamos que no diera error</span></div>
<div class="line"><span class="lineno">  587</span>                <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement) {</div>
<div class="line"><span class="lineno">  588</span>                    <span class="keywordflow">throw</span> <span class="keyword">new</span> PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  589</span>                }</div>
<div class="line"><span class="lineno">  590</span>                <span class="comment">//Cogemos los datos, como están limitados hacemos fetch all</span></div>
<div class="line"><span class="lineno">  591</span>                $datosCajas[] = $pdoStatement-&gt;fetchAll(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  592</span>            }</div>
<div class="line"><span class="lineno">  593</span>            <span class="keywordflow">return</span> $datosCajas;</div>
<div class="line"><span class="lineno">  594</span>        }</div>
<div class="line"><span class="lineno">  595</span>        <span class="keywordflow">catch</span>(\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  596</span>           <span class="keywordflow">throw</span> $pdoError;</div>
<div class="line"><span class="lineno">  597</span>        }</div>
<div class="line"><span class="lineno">  598</span>        <span class="keywordflow">catch</span>(\Exception $error) {</div>
<div class="line"><span class="lineno">  599</span>            <span class="keywordflow">throw</span> $error;</div>
<div class="line"><span class="lineno">  600</span>        }</div>
<div class="line"><span class="lineno">  601</span>    }</div>
<div class="ttc" id="aclass_infraestructuras_1_1_bd_html_a10e5c8f21b891ea8b624264fa8a14125"><div class="ttname"><a href="class_infraestructuras_1_1_bd.html#a10e5c8f21b891ea8b624264fa8a14125">Infraestructuras\Bd\recuperarDatosBDNum</a></div><div class="ttdeci">recuperarDatosBDNum($sentencia, $datos=[], $pdo=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> Bd.php:275</div></div>
<div class="ttc" id="aclass_infraestructuras_1_1_bd_html_a3f1ba034ae9de43dea72594438732cef"><div class="ttname"><a href="class_infraestructuras_1_1_bd.html#a3f1ba034ae9de43dea72594438732cef">Infraestructuras\Bd\recuperDatosBD</a></div><div class="ttdeci">recuperDatosBD($sentencia, $datos=[])</div><div class="ttdef"><b>Definition:</b> Bd.php:242</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a576f15daee9e501398c9529542dfc94e" name="a576f15daee9e501398c9529542dfc94e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a576f15daee9e501398c9529542dfc94e">&#9670;&nbsp;</a></span>cargarGeneros()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::cargarGeneros </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Carga los géneros desde la BD</p>
<dl class="section return"><dt>Devuelve</dt><dd>mixed Devuelve un string en caso de error o un array con los géneros </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  524</span>                                    {</div>
<div class="line"><span class="lineno">  525</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  526</span>            $sentencia = <span class="stringliteral">&quot;SELECT nombre_genero FROM generos LIMIT 0, 25;&quot;</span>;</div>
<div class="line"><span class="lineno">  527</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $this-&gt;<a class="code hl_function" href="class_infraestructuras_1_1_bd.html#a3f1ba034ae9de43dea72594438732cef">recuperDatosBD</a>($sentencia, []);</div>
<div class="line"><span class="lineno">  528</span>            <span class="keywordflow">if</span>(!<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">  529</span>                <span class="keywordflow">throw</span> new \PDOException(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>);</div>
<div class="line"><span class="lineno">  530</span>            }</div>
<div class="line"><span class="lineno">  531</span>            $generos = <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>-&gt;fetchAll(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  532</span>            <span class="keywordflow">return</span> $generos;</div>
<div class="line"><span class="lineno">  533</span>        }</div>
<div class="line"><span class="lineno">  534</span>        <span class="keywordflow">catch</span>(\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  535</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  536</span>        }</div>
<div class="line"><span class="lineno">  537</span>        <span class="keywordflow">catch</span>(\Exception $error) {</div>
<div class="line"><span class="lineno">  538</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  539</span>        }</div>
<div class="line"><span class="lineno">  540</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac1bff4b22872876a8d86f8ff3b52454f" name="ac1bff4b22872876a8d86f8ff3b52454f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1bff4b22872876a8d86f8ff3b52454f">&#9670;&nbsp;</a></span>codificarArrayUtf8()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::codificarArrayUtf8 </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$array</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Codifica a utf8 el array o string</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">mixed</td><td class="paramname">$array</td><td>Puede ser un array o una string</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>void No devuelve nada </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  549</span>                                                 {</div>
<div class="line"><span class="lineno">  550</span>        <span class="comment">//Comprobamos si es un array</span></div>
<div class="line"><span class="lineno">  551</span>        <span class="keywordflow">if</span>(is_array($array)){</div>
<div class="line"><span class="lineno">  552</span>            array_walk($array, [$this, <span class="stringliteral">&quot;codificarArrayUtf8&quot;</span>]);</div>
<div class="line"><span class="lineno">  553</span>        }</div>
<div class="line"><span class="lineno">  554</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(is_string($array)){</div>
<div class="line"><span class="lineno">  555</span>            $array = mb_convert_encoding($array, <span class="stringliteral">&quot;UTF-8&quot;</span>, <span class="stringliteral">&quot;auto&quot;</span>);</div>
<div class="line"><span class="lineno">  556</span>        }</div>
<div class="line"><span class="lineno">  557</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae33e84d105db2a7a144af2e6f43e7a47" name="ae33e84d105db2a7a144af2e6f43e7a47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae33e84d105db2a7a144af2e6f43e7a47">&#9670;&nbsp;</a></span>comprobarUsuario()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::comprobarUsuario </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$usuario</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Comprueba si el usuario existe y devuelve la contraseña hasheada</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$usuario</td><td><a class="el" href="class_infraestructuras_1_1_email.html">Email</a> del usuario</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>mixed Error o la contraseña del usuario hasheada o false si el usuario no existe </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  499</span>                                        {</div>
<div class="line"><span class="lineno">  500</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  501</span>            <span class="comment">//Creamos una sentencia que nos devuelva la clave del usuario si coincide el usuario</span></div>
<div class="line"><span class="lineno">  502</span>            $sentencia = <span class="stringliteral">&quot;SELECT pwd FROM usuarios WHERE email = ?&quot;</span>;</div>
<div class="line"><span class="lineno">  503</span>            <span class="comment">//Devolvemos lo que nos devuelve (Error o la pwd hasheada del usuario)</span></div>
<div class="line"><span class="lineno">  504</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $this-&gt;<a class="code hl_function" href="class_infraestructuras_1_1_bd.html#a3f1ba034ae9de43dea72594438732cef">recuperDatosBD</a>($sentencia, [<a class="code hl_variable" href="partidas_8php.html#a559c8003f481610caf373b85cc607fb6">$usuario</a>]);</div>
<div class="line"><span class="lineno">  505</span>            <span class="keywordflow">if</span>(is_string(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>)){</div>
<div class="line"><span class="lineno">  506</span>                <span class="keywordflow">throw</span> new \Exception(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>);</div>
<div class="line"><span class="lineno">  507</span>            }</div>
<div class="line"><span class="lineno">  508</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>-&gt;fetch(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  509</span>        }</div>
<div class="line"><span class="lineno">  510</span>        <span class="keywordflow">catch</span>(\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  511</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  512</span>        }</div>
<div class="line"><span class="lineno">  513</span>        <span class="keywordflow">catch</span>(\Exception $error) {</div>
<div class="line"><span class="lineno">  514</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  515</span>        }</div>
<div class="line"><span class="lineno">  516</span>        <span class="keywordflow">return</span> isset(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>[<span class="stringliteral">&quot;pwd&quot;</span>]) ? <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>[<span class="stringliteral">&quot;pwd&quot;</span>]: <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  517</span>    }</div>
<div class="ttc" id="apartidas_8php_html_a559c8003f481610caf373b85cc607fb6"><div class="ttname"><a href="partidas_8php.html#a559c8003f481610caf373b85cc607fb6">$usuario</a></div><div class="ttdeci">$usuario</div><div class="ttdef"><b>Definition:</b> partidas.php:11</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6183277a3e067c08329238cbc1da56de" name="a6183277a3e067c08329238cbc1da56de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6183277a3e067c08329238cbc1da56de">&#9670;&nbsp;</a></span>gestionarFichero()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::gestionarFichero </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fichero</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$carpetaFichero</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Comprueba que se subiera bien el fichero y lo mueve a un directorio con el correo del usuario</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$fichero</td><td>FIchero a subir con sus propiedades error, tmp_name, size, name </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$usuario</td><td>Correo del usuario</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>mixed Si la operación salió bien (boolean) o hubo algún error (string con el error) </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  436</span>                                                               {</div>
<div class="line"><span class="lineno">  437</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  438</span>            <span class="keywordflow">if</span>(is_array($fichero[<span class="stringliteral">&quot;name&quot;</span>])){</div>
<div class="line"><span class="lineno">  439</span>                <span class="comment">//Comprobamos si existe la carpeta en el disco duro</span></div>
<div class="line"><span class="lineno">  440</span>                <span class="keywordflow">if</span>(!is_dir($carpetaFichero)) {</div>
<div class="line"><span class="lineno">  441</span>                    <span class="comment">//Si no existe la creamos</span></div>
<div class="line"><span class="lineno">  442</span>                    <span class="keywordflow">if</span>(!mkdir($carpetaFichero, 777)) {</div>
<div class="line"><span class="lineno">  443</span>                            <span class="keywordflow">throw</span> new \RuntimeException(<span class="stringliteral">&quot;No se pudo crear la carpeta donde guarda la imagen&quot;</span>);</div>
<div class="line"><span class="lineno">  444</span>                    }</div>
<div class="line"><span class="lineno">  445</span>                }</div>
<div class="line"><span class="lineno">  446</span>                <span class="keywordflow">for</span>($i = 0; $i &lt; count($fichero[<span class="stringliteral">&quot;name&quot;</span>]); $i++) {</div>
<div class="line"><span class="lineno">  447</span>                    <span class="comment">//Comprobamos que no hubiese errores en la subida</span></div>
<div class="line"><span class="lineno">  448</span>                    <span class="keywordflow">if</span>($fichero[<span class="stringliteral">&quot;error&quot;</span>][$i] != 0){</div>
<div class="line"><span class="lineno">  449</span>                        <span class="keywordflow">throw</span> new \RuntimeException (<span class="stringliteral">&quot;Hubo un error en la subida del fichero&quot;</span>);</div>
<div class="line"><span class="lineno">  450</span>                    }</div>
<div class="line"><span class="lineno">  451</span>                    $nuevaRutaArchivo = $carpetaFichero . DIRECTORY_SEPARATOR . $fichero[<span class="stringliteral">&quot;name&quot;</span>][$i];</div>
<div class="line"><span class="lineno">  452</span>                    <span class="comment">//Movemos el archivo a la carpeta creada</span></div>
<div class="line"><span class="lineno">  453</span>                    $resultadoSentencia = move_uploaded_file($fichero[<span class="stringliteral">&quot;tmp_name&quot;</span>][$i], $nuevaRutaArchivo);</div>
<div class="line"><span class="lineno">  454</span>                    <span class="comment">//Si no se pudo mover lanzamos una excepción</span></div>
<div class="line"><span class="lineno">  455</span>                    <span class="keywordflow">if</span>(!$resultadoSentencia){</div>
<div class="line"><span class="lineno">  456</span>                        <span class="keywordflow">throw</span> new \RuntimeException(<span class="stringliteral">&quot;No se puede realizar el cambio de localización del archivo&quot;</span>);</div>
<div class="line"><span class="lineno">  457</span>                    }</div>
<div class="line"><span class="lineno">  458</span>                    <span class="comment">//Guardamos en $resultado la ruta del archivo</span></div>
<div class="line"><span class="lineno">  459</span>                    <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>[] = $nuevaRutaArchivo;</div>
<div class="line"><span class="lineno">  460</span>                }</div>
<div class="line"><span class="lineno">  461</span>            }</div>
<div class="line"><span class="lineno">  462</span>            <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  463</span>                <span class="comment">//Comprobamos que no hubiese errores en la subida</span></div>
<div class="line"><span class="lineno">  464</span>                <span class="keywordflow">if</span>($fichero[<span class="stringliteral">&quot;error&quot;</span>] != 0){</div>
<div class="line"><span class="lineno">  465</span>                    <span class="keywordflow">throw</span> new \RuntimeException (<span class="stringliteral">&quot;Hubo un error en la subida del fichero&quot;</span>);</div>
<div class="line"><span class="lineno">  466</span>                }</div>
<div class="line"><span class="lineno">  467</span>                <span class="comment">//Comprobamos si existe la carpeta en el disco duro</span></div>
<div class="line"><span class="lineno">  468</span>                <span class="keywordflow">if</span>(!is_dir($carpetaFichero)) {</div>
<div class="line"><span class="lineno">  469</span>                     <span class="comment">//Si no existe la creamos</span></div>
<div class="line"><span class="lineno">  470</span>                <span class="keywordflow">if</span>(!mkdir($carpetaFichero, 777)) {</div>
<div class="line"><span class="lineno">  471</span>                        <span class="keywordflow">throw</span> new \RuntimeException(<span class="stringliteral">&quot;No se pudo crear la carpeta donde guarda la imagen&quot;</span>);</div>
<div class="line"><span class="lineno">  472</span>                }</div>
<div class="line"><span class="lineno">  473</span>                }</div>
<div class="line"><span class="lineno">  474</span>                $nuevaRutaArchivo = $carpetaFichero . DIRECTORY_SEPARATOR . $fichero[<span class="stringliteral">&quot;name&quot;</span>];</div>
<div class="line"><span class="lineno">  475</span>                <span class="comment">//Movemos el archivo a la carpeta creada</span></div>
<div class="line"><span class="lineno">  476</span>                <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = move_uploaded_file($fichero[<span class="stringliteral">&quot;tmp_name&quot;</span>], $nuevaRutaArchivo);</div>
<div class="line"><span class="lineno">  477</span>                <span class="comment">//Si no se pudo mover lanzamos una excepción</span></div>
<div class="line"><span class="lineno">  478</span>                <span class="keywordflow">if</span>(!<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>){</div>
<div class="line"><span class="lineno">  479</span>                    <span class="keywordflow">throw</span> new \RuntimeException(<span class="stringliteral">&quot;No se puede realizar el cambio de localización del archivo&quot;</span>);</div>
<div class="line"><span class="lineno">  480</span>                }</div>
<div class="line"><span class="lineno">  481</span>                <span class="comment">//Guardamos en $resultado la ruta del archivo</span></div>
<div class="line"><span class="lineno">  482</span>                <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $nuevaRutaArchivo;</div>
<div class="line"><span class="lineno">  483</span>            }</div>
<div class="line"><span class="lineno">  484</span>        }</div>
<div class="line"><span class="lineno">  485</span>        <span class="keywordflow">catch</span>(\RuntimeException $error){</div>
<div class="line"><span class="lineno">  486</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> =  <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  487</span>        }</div>
<div class="line"><span class="lineno">  488</span>        <span class="comment">//Si es verdadero devolvemos true, sino devolvemos un mensaje diciendo el error</span></div>
<div class="line"><span class="lineno">  489</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>;</div>
<div class="line"><span class="lineno">  490</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6f361d02d50785e43cf84eaeb064a521" name="a6f361d02d50785e43cf84eaeb064a521"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f361d02d50785e43cf84eaeb064a521">&#9670;&nbsp;</a></span>iniciarTransaccionManual()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::iniciarTransaccionManual </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Conecta con PDo e inicia la transacción, es usado para cuanto tenemos que hacer opciones que no tienen que ver con la BD pero necesitamos que si fallan se anulen las acciones en la BD también</p>
<dl class="section return"><dt>Devuelve</dt><dd>PDO Devuelve el pdo </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  184</span>                                               {</div>
<div class="line"><span class="lineno">  185</span>        <span class="comment">//Leemos la configuración</span></div>
<div class="line"><span class="lineno">  186</span>        $pdo = $this-&gt;conectarBD();</div>
<div class="line"><span class="lineno">  187</span>        <span class="comment">//iniciamos la transaccion</span></div>
<div class="line"><span class="lineno">  188</span>        $pdo-&gt;beginTransaction();</div>
<div class="line"><span class="lineno">  189</span>        <span class="keywordflow">return</span> $pdo;</div>
<div class="line"><span class="lineno">  190</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa6d7ab43437e9d1bae4d91b7d09efe76" name="aa6d7ab43437e9d1bae4d91b7d09efe76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6d7ab43437e9d1bae4d91b7d09efe76">&#9670;&nbsp;</a></span>loginUsuario()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::loginUsuario </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datosUsuario</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  390</span>                                                {</div>
<div class="line"><span class="lineno">  391</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  392</span>            <span class="comment">//Comprobamos que haya rellenado todos los campos Oblig (En este caso sabemos que todos los campos son obligatorios por lo que le pasamos las claves del arrya asociativo)</span></div>
<div class="line"><span class="lineno">  393</span>            $camposOblig = $this-&gt;comprobarCamposOblig(<a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>, array_keys(<a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>));</div>
<div class="line"><span class="lineno">  394</span>        }</div>
<div class="line"><span class="lineno">  395</span>        <span class="keywordflow">catch</span> (\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  396</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  397</span>        }</div>
<div class="line"><span class="lineno">  398</span>        <span class="keywordflow">catch</span>(\Exception $error){</div>
<div class="line"><span class="lineno">  399</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  400</span>        }</div>
<div class="line"><span class="lineno">  401</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>;</div>
<div class="line"><span class="lineno">  402</span>    }</div>
<div class="ttc" id="acaja_sorpresa_8php_html_a6b32d1257bd00df02f59ecfdbac9a439"><div class="ttname"><a href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a></div><div class="ttdeci">$datosUsuario</div><div class="ttdef"><b>Definition:</b> cajaSorpresa.php:7</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a10e5c8f21b891ea8b624264fa8a14125" name="a10e5c8f21b891ea8b624264fa8a14125"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10e5c8f21b891ea8b624264fa8a14125">&#9670;&nbsp;</a></span>recuperarDatosBDNum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::recuperarDatosBDNum </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$sentencia</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datos</em> = <code>[]</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pdo</em> = <code>&quot;&quot;</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Ejecuta y prepara la sentencia que le pasamos, se usa para sentencias que necesitan números como parámetros</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$sentencia</td><td>Sentencia a ejecutar </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$datos</td><td>Datos a añadir como parámetros </td></tr>
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Elemento PDO que usamos en una transaccion manual</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>mixed Devuelve un PDOSTamente o false en caso de error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  275</span>                                                                            {</div>
<div class="line"><span class="lineno">  276</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  277</span>            <span class="keywordflow">if</span>($pdo == <span class="stringliteral">&quot;&quot;</span>){</div>
<div class="line"><span class="lineno">  278</span>                <span class="comment">//Creo la conexión</span></div>
<div class="line"><span class="lineno">  279</span>                $pdo = $this-&gt;conectarBD();</div>
<div class="line"><span class="lineno">  280</span>            }</div>
<div class="line"><span class="lineno">  281</span>            <span class="comment">//Ejecutamos la sentencia</span></div>
<div class="line"><span class="lineno">  282</span>            $pdoStatement = $pdo-&gt;prepare($sentencia);</div>
<div class="line"><span class="lineno">  283</span>            <span class="comment">//Cargamos los parámetros</span></div>
<div class="line"><span class="lineno">  284</span>            $this-&gt;asignarValoresParam(<a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a>, $pdoStatement);</div>
<div class="line"><span class="lineno">  285</span>            <span class="comment">//Ejecutamos y asignamos las variables a la vez</span></div>
<div class="line"><span class="lineno">  286</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $pdoStatement-&gt;execute();</div>
<div class="line"><span class="lineno">  287</span>            <span class="keywordflow">if</span>(!<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>){</div>
<div class="line"><span class="lineno">  288</span>                <span class="keywordflow">throw</span> new \PDOException($pdoStatement-&gt;errorInfo()[2]);</div>
<div class="line"><span class="lineno">  289</span>            }</div>
<div class="line"><span class="lineno">  290</span>            <span class="comment">//Devolvemos el $pdoStatement para poder hacer fetch con él</span></div>
<div class="line"><span class="lineno">  291</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $pdoStatement;</div>
<div class="line"><span class="lineno">  292</span>        }</div>
<div class="line"><span class="lineno">  293</span>        <span class="comment">//Ambos try catch devuelve el error para mostrarlo por pantalla y poder solucionarlo, cuando lo acabemos quitaremos la muestra de los errores, esto es sólo para desarrollo</span></div>
<div class="line"><span class="lineno">  294</span>        <span class="keywordflow">catch</span>(\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  295</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  296</span>        }</div>
<div class="line"><span class="lineno">  297</span>        <span class="keywordflow">catch</span>(\Exception $error) {</div>
<div class="line"><span class="lineno">  298</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span>  . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  299</span>        }</div>
<div class="line"><span class="lineno">  300</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>;</div>
<div class="line"><span class="lineno">  301</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3f1ba034ae9de43dea72594438732cef" name="a3f1ba034ae9de43dea72594438732cef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f1ba034ae9de43dea72594438732cef">&#9670;&nbsp;</a></span>recuperDatosBD()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::recuperDatosBD </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$sentencia</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datos</em> = <code>[]</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Método para realizar select (Estático)</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$sentencia</td><td>Sentencia de la BD a ejecutar </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$datos</td><td>Array con los parámetros a asignar en la función preparada</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>mixed Puede devolver un pdoStatement con los datos o false si se produjo un error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  242</span>                                                            {</div>
<div class="line"><span class="lineno">  243</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  244</span>            <span class="comment">//Creo la conexión</span></div>
<div class="line"><span class="lineno">  245</span>            $pdo = $this-&gt;conectarBD();</div>
<div class="line"><span class="lineno">  246</span>            <span class="comment">//Ejecutamos la sentencia</span></div>
<div class="line"><span class="lineno">  247</span>            $pdoStatement = $pdo-&gt;prepare($sentencia);</div>
<div class="line"><span class="lineno">  248</span>            <span class="comment">//Ejecutamos y asignamos las variables a la vez</span></div>
<div class="line"><span class="lineno">  249</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $pdoStatement-&gt;execute(<a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a>);</div>
<div class="line"><span class="lineno">  250</span>            <span class="keywordflow">if</span>(!<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>){</div>
<div class="line"><span class="lineno">  251</span>                <span class="keywordflow">throw</span> new \PDOException($pdoStatement-&gt;errorInfo()[2]);</div>
<div class="line"><span class="lineno">  252</span>            }</div>
<div class="line"><span class="lineno">  253</span>            <span class="comment">//Devolvemos el $pdoStatement para poder hacer fetch con él</span></div>
<div class="line"><span class="lineno">  254</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $pdoStatement;</div>
<div class="line"><span class="lineno">  255</span>        }</div>
<div class="line"><span class="lineno">  256</span>        <span class="comment">//Ambos try catch devuelve el error para mostrarlo por pantalla y poder solucionarlo, cuando lo acabemos quitaremos la muestra de los errores, esto es sólo para desarrollo</span></div>
<div class="line"><span class="lineno">  257</span>        <span class="keywordflow">catch</span>(\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  258</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  259</span>        }</div>
<div class="line"><span class="lineno">  260</span>        <span class="keywordflow">catch</span>(\Exception $error) {</div>
<div class="line"><span class="lineno">  261</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span>  . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  262</span>        }</div>
<div class="line"><span class="lineno">  263</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>;</div>
<div class="line"><span class="lineno">  264</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae5f6e97a847540c659d25aedcd2b4f8d" name="ae5f6e97a847540c659d25aedcd2b4f8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5f6e97a847540c659d25aedcd2b4f8d">&#9670;&nbsp;</a></span>registrarUsuario()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::registrarUsuario </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datosUsuario</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datosOblig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fichero</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Registra al usuario en la BD</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$datosUsuario</td><td>Todos los datos a insertal del usuario </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$datosOblig</td><td>Cada uno de los campos que tiene que tener rellenado si o si </td></tr>
    <tr><td class="paramtype">File</td><td class="paramname">$fichero</td><td>Fichero a subir</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>mixed Cadena con el error o true si todo fue bien </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  312</span>                                                                           {</div>
<div class="line"><span class="lineno">  313</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  314</span>            <span class="comment">//Validamos todos los campos</span></div>
<div class="line"><span class="lineno">  315</span>            $this-&gt;validarCamposForm(<a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>);</div>
<div class="line"><span class="lineno">  316</span>            <span class="comment">//Comprobamos que todos los campos sean validos ,si no son válidos lanzamos una excepción</span></div>
<div class="line"><span class="lineno">  317</span>            <span class="keywordflow">if</span>(!$this-&gt;comprobarCamposOblig(<a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>, $datosOblig)){</div>
<div class="line"><span class="lineno">  318</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&quot;Debe rellenar todos los campos obligatorios&quot;</span>);</div>
<div class="line"><span class="lineno">  319</span>            }</div>
<div class="line"><span class="lineno">  320</span>            <span class="comment">//Comprobamos que las contraseñas coincidan, si no coinciden lanzamos una excepción</span></div>
<div class="line"><span class="lineno">  321</span>            <span class="keywordflow">if</span>(!$this-&gt;comprobarClaves(<a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;pwd&quot;</span>], <a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;pwd2&quot;</span>])){</div>
<div class="line"><span class="lineno">  322</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&quot;Las contraseñas no coinciden&quot;</span>);</div>
<div class="line"><span class="lineno">  323</span>            }</div>
<div class="line"><span class="lineno">  324</span>            <span class="comment">//Eliminamos la segunda contraseña del array ya que no nos hará falta</span></div>
<div class="line"><span class="lineno">  325</span>            unset(<a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;pwd2&quot;</span>]);</div>
<div class="line"><span class="lineno">  326</span>            <span class="comment">//Comprobamos que el email sea válido</span></div>
<div class="line"><span class="lineno">  327</span>            <span class="keywordflow">if</span>(!$this-&gt;comprobarEmail(<a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;email&quot;</span>])) {</div>
<div class="line"><span class="lineno">  328</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&quot;El email no es válido&quot;</span>);</div>
<div class="line"><span class="lineno">  329</span>            }</div>
<div class="line"><span class="lineno">  330</span>            <span class="comment">//Comprobamos que no exista ya alguien con ese correo y que no haya dado un error</span></div>
<div class="line"><span class="lineno">  331</span>            $claveUser = $this-&gt;<a class="code hl_function" href="class_infraestructuras_1_1_bd.html#ae33e84d105db2a7a144af2e6f43e7a47">comprobarUsuario</a>(<a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;email&quot;</span>]);</div>
<div class="line"><span class="lineno">  332</span>            <span class="comment">//Comprobamos que no diera error la sentencia</span></div>
<div class="line"><span class="lineno">  333</span>            <span class="keywordflow">if</span>(is_string($claveUser) &amp;&amp; stripos($claveUser, <span class="stringliteral">&quot;error&quot;</span>) !== <span class="keyword">false</span>){</div>
<div class="line"><span class="lineno">  334</span>                <span class="keywordflow">throw</span> new \PDOException($claveUser);</div>
<div class="line"><span class="lineno">  335</span>            }</div>
<div class="line"><span class="lineno">  336</span>            <span class="comment">//Comprobamos que no exista el usuairo</span></div>
<div class="line"><span class="lineno">  337</span>            <span class="keywordflow">if</span>($claveUser !== <span class="keyword">false</span>){</div>
<div class="line"><span class="lineno">  338</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&quot;Ya existe un usuario registrado con ese correo&quot;</span>);</div>
<div class="line"><span class="lineno">  339</span>            }</div>
<div class="line"><span class="lineno">  340</span>            <span class="comment">//Comprobamos que se subiera bien el fichero y lo movemos a una carpeta en el disco duro</span></div>
<div class="line"><span class="lineno">  341</span>            $carpetaFichero = dirname(__DIR__, 2) . DIRECTORY_SEPARATOR  . <span class="stringliteral">&quot;img&quot;</span> . DIRECTORY_SEPARATOR . <span class="stringliteral">&quot;usuarios&quot;</span> . DIRECTORY_SEPARATOR  . <a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;email&quot;</span>];</div>
<div class="line"><span class="lineno">  342</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $this-&gt;<a class="code hl_function" href="class_infraestructuras_1_1_bd.html#a6183277a3e067c08329238cbc1da56de">gestionarFichero</a>($fichero, $carpetaFichero);</div>
<div class="line"><span class="lineno">  343</span>            <span class="comment">//Si no se pudo mover mandamos un error</span></div>
<div class="line"><span class="lineno">  344</span>            <span class="keywordflow">if</span>(mb_stristr(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>, <span class="stringliteral">&quot;error&quot;</span>) != <span class="keyword">false</span>){</div>
<div class="line"><span class="lineno">  345</span>                <span class="keywordflow">throw</span> new \Exception(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>);</div>
<div class="line"><span class="lineno">  346</span>            }</div>
<div class="line"><span class="lineno">  347</span>            <span class="comment">//Añadimos al array la ruta del archivo para guardarla en la BD</span></div>
<div class="line"><span class="lineno">  348</span>            <a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;imagenPerfil&quot;</span>] = <span class="stringliteral">&quot;..&quot;</span> . DIRECTORY_SEPARATOR . <span class="stringliteral">&quot;img&quot;</span> . DIRECTORY_SEPARATOR . <span class="stringliteral">&quot;usuarios&quot;</span> . DIRECTORY_SEPARATOR  . <a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;email&quot;</span>] . DIRECTORY_SEPARATOR . $fichero[<span class="stringliteral">&quot;name&quot;</span>];</div>
<div class="line"><span class="lineno">  349</span>            <span class="comment">//Hasheamos la contraseña</span></div>
<div class="line"><span class="lineno">  350</span>            <a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;pwd&quot;</span>] = password_hash(<a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;pwd&quot;</span>], PASSWORD_DEFAULT);</div>
<div class="line"><span class="lineno">  351</span>            <span class="comment">//Convertimos todos los campos NO obligatorios que NO se rellenaron a null</span></div>
<div class="line"><span class="lineno">  352</span>            $this-&gt;comprobarCamposNoOblig(<a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>, $datosOblig);</div>
<div class="line"><span class="lineno">  353</span>            <span class="comment">//Fecha de registro (Como es ahora metemos nosotros la fecha actual) con la zona horaria de Europa, lo mismo para ultima modificación y ultimo acceso</span></div>
<div class="line"><span class="lineno">  354</span>            $fechaRegistro = <span class="keyword">new</span> DateTime(<span class="stringliteral">&quot;now&quot;</span>);</div>
<div class="line"><span class="lineno">  355</span>            <span class="comment">//Sentencia para insertar los datos en la BD, no aparece el rol porque por defecto añade el rol estándar en la BD</span></div>
<div class="line"><span class="lineno">  356</span>            $sentencia = <span class="stringliteral">&quot;INSERT INTO usuarios (email, pwd, nombre, apellidos, telefono, fecha_nac, fecha_registro, direccion, fecha_ult_modif, fecha_ult_acceso, rol, genero_favorito, imagen_perfil) VALUES (?, ?, ?, ?, ?, ?, &#39;&quot;</span> . date_format($fechaRegistro, <span class="stringliteral">&quot;Y-m-d&quot;</span>) .  <span class="stringliteral">&quot;&#39;, ?, NOW(), NOW(), 2, ?, ?);&quot;</span>;</div>
<div class="line"><span class="lineno">  357</span>            <span class="comment">//Ejecutamos la sentencia mediante la función que asignará los valores a la sentencia preparada y devolverá el resultado</span></div>
<div class="line"><span class="lineno">  358</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = $this-&gt;<a class="code hl_function" href="class_infraestructuras_1_1_bd.html#ae1876f8a3d203fc06ed2cc11f89a419c">agregarModificarDatosBD</a>($sentencia, <a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>);</div>
<div class="line"><span class="lineno">  359</span>        }</div>
<div class="line"><span class="lineno">  360</span>        <span class="keywordflow">catch</span>(\Exception $error){</div>
<div class="line"><span class="lineno">  361</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot;: &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  362</span>        }</div>
<div class="line"><span class="lineno">  363</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>;</div>
<div class="line"><span class="lineno">  364</span>    }</div>
<div class="ttc" id="aclass_infraestructuras_1_1_bd_html_a6183277a3e067c08329238cbc1da56de"><div class="ttname"><a href="class_infraestructuras_1_1_bd.html#a6183277a3e067c08329238cbc1da56de">Infraestructuras\Bd\gestionarFichero</a></div><div class="ttdeci">gestionarFichero($fichero, $carpetaFichero)</div><div class="ttdef"><b>Definition:</b> Bd.php:436</div></div>
<div class="ttc" id="aclass_infraestructuras_1_1_bd_html_ae1876f8a3d203fc06ed2cc11f89a419c"><div class="ttname"><a href="class_infraestructuras_1_1_bd.html#ae1876f8a3d203fc06ed2cc11f89a419c">Infraestructuras\Bd\agregarModificarDatosBD</a></div><div class="ttdeci">agregarModificarDatosBD($sentencia, $datos)</div><div class="ttdef"><b>Definition:</b> Bd.php:108</div></div>
<div class="ttc" id="aclass_infraestructuras_1_1_bd_html_ae33e84d105db2a7a144af2e6f43e7a47"><div class="ttname"><a href="class_infraestructuras_1_1_bd.html#ae33e84d105db2a7a144af2e6f43e7a47">Infraestructuras\Bd\comprobarUsuario</a></div><div class="ttdeci">comprobarUsuario($usuario)</div><div class="ttdef"><b>Definition:</b> Bd.php:499</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0847d581eaf3e864bd5f09baedb45720" name="a0847d581eaf3e864bd5f09baedb45720"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0847d581eaf3e864bd5f09baedb45720">&#9670;&nbsp;</a></span>ultimoProducto()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Infraestructuras\Bd::ultimoProducto </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$numProd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Carga los últimos productos para el alert</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$numProd</td><td>Número de productos</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>array Array con la información de los productos </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  610</span>                                             {</div>
<div class="line"><span class="lineno">  611</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  612</span>            <span class="comment">//Creamos la sentencia</span></div>
<div class="line"><span class="lineno">  613</span>            $sentencia = <span class="stringliteral">&quot;SELECT id_producto, imagen_producto, nombre, precio FROM productos ORDER BY id_producto DESC LIMIT 0, :numProduc&quot;</span>;</div>
<div class="line"><span class="lineno">  614</span>            <span class="comment">//La prepraramos ya que la ejecutaremos varias veces</span></div>
<div class="line"><span class="lineno">  615</span>            $pdoStatement = $this-&gt;<a class="code hl_function" href="class_infraestructuras_1_1_bd.html#a10e5c8f21b891ea8b624264fa8a14125">recuperarDatosBDNum</a>($sentencia, [<span class="stringliteral">&quot;numProduc&quot;</span> =&gt; intval($numProd)]);</div>
<div class="line"><span class="lineno">  616</span>            <span class="comment">//Comprobamos que no diera error</span></div>
<div class="line"><span class="lineno">  617</span>            <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement) {</div>
<div class="line"><span class="lineno">  618</span>                <span class="keywordflow">throw</span> <span class="keyword">new</span> PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  619</span>            }</div>
<div class="line"><span class="lineno">  620</span>            <span class="comment">//Devolvemos el fetch ya que sólo devolverá 1</span></div>
<div class="line"><span class="lineno">  621</span>            <span class="keywordflow">return</span> $pdoStatement-&gt;fetchAll(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  622</span>        }</div>
<div class="line"><span class="lineno">  623</span>        <span class="keywordflow">catch</span>(\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  624</span>            <span class="keywordflow">throw</span> $pdoError;</div>
<div class="line"><span class="lineno">  625</span>         }</div>
<div class="line"><span class="lineno">  626</span>         <span class="keywordflow">catch</span>(\Exception $error) {</div>
<div class="line"><span class="lineno">  627</span>             <span class="keywordflow">throw</span> $error;</div>
<div class="line"><span class="lineno">  628</span>         }</div>
<div class="line"><span class="lineno">  629</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<hr/>La documentación para esta clase fue generada a partir del siguiente fichero:<ul>
<li>proyecto/php/Infraestructuras/<a class="el" href="_bd_8php.html">Bd.php</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generado el Domingo, 13 de Marzo de 2022 20:14:25 para My Project por&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
