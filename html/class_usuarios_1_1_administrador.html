<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Referencia de la Clase Usuarios\Administrador</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generado por Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Buscar','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Buscar');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_usuarios.html">Usuarios</a></li><li class="navelem"><a class="el" href="class_usuarios_1_1_administrador.html">Administrador</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Métodos públicos</a> &#124;
<a href="class_usuarios_1_1_administrador-members.html">Lista de todos los miembros</a>  </div>
  <div class="headertitle"><div class="title">Referencia de la Clase Usuarios\Administrador</div></div>
</div><!--header-->
<div class="contents">

<p>Herencias <a class="el" href="class_usuarios_1_1_usuario.html">Usuarios\Usuario</a>.</p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Métodos públicos</h2></td></tr>
<tr class="memitem:a6603bbdc6f0c93875ec87e25022eeeb3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#a6603bbdc6f0c93875ec87e25022eeeb3">__construct</a> ($email, $rol)</td></tr>
<tr class="separator:a6603bbdc6f0c93875ec87e25022eeeb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcdc7ed29ee6860c11b656457010ed50"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#afcdc7ed29ee6860c11b656457010ed50">cargarHistorial</a> ($filtro, $propio=true)</td></tr>
<tr class="separator:afcdc7ed29ee6860c11b656457010ed50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa120a4645e7bd0b4c74b10cd7156afa7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#aa120a4645e7bd0b4c74b10cd7156afa7">cambiarRol</a> ($usuario, $rolActual)</td></tr>
<tr class="separator:aa120a4645e7bd0b4c74b10cd7156afa7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a671a52fb77048bc4a5e5e3bc9944635d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#a671a52fb77048bc4a5e5e3bc9944635d">cargarUsuarios</a> ($filtroUsuario)</td></tr>
<tr class="separator:a671a52fb77048bc4a5e5e3bc9944635d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca09c4a5be65b23e35155fcdc13da941"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#aca09c4a5be65b23e35155fcdc13da941">editarProducto</a> ()</td></tr>
<tr class="separator:aca09c4a5be65b23e35155fcdc13da941"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7bee6c23d98191f28442ce035c9c977d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#a7bee6c23d98191f28442ce035c9c977d">eliminarProducto</a> ()</td></tr>
<tr class="separator:a7bee6c23d98191f28442ce035c9c977d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d4d8d2865cb5ef895d17009cca3c608"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#a8d4d8d2865cb5ef895d17009cca3c608">crearProducto</a> ()</td></tr>
<tr class="separator:a8d4d8d2865cb5ef895d17009cca3c608"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f7a1bdbc8b625a8c7266196938e8113"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#a5f7a1bdbc8b625a8c7266196938e8113">crearPartida</a> ($datosPartida, $imagenesPartida)</td></tr>
<tr class="separator:a5f7a1bdbc8b625a8c7266196938e8113"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea36409b785e62cc80586e11979d52d4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#aea36409b785e62cc80586e11979d52d4">recuperarDatosActualesPartida</a> ($idPartida)</td></tr>
<tr class="separator:aea36409b785e62cc80586e11979d52d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f9120bde72c498088b79607ac02e528"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#a8f9120bde72c498088b79607ac02e528">editarPartida</a> ($datosPartida)</td></tr>
<tr class="separator:a8f9120bde72c498088b79607ac02e528"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bf032ae9b2504b0194bbff8c73eeb08"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#a3bf032ae9b2504b0194bbff8c73eeb08">eliminarPartida</a> ($idPartida)</td></tr>
<tr class="separator:a3bf032ae9b2504b0194bbff8c73eeb08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ebf9a3463ba2fb24d200175247612d2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#a6ebf9a3463ba2fb24d200175247612d2">aceptarSolicitudPartida</a> ($datosReserva)</td></tr>
<tr class="separator:a6ebf9a3463ba2fb24d200175247612d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a6b0b33728a95357c340ce21091ee2d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#a3a6b0b33728a95357c340ce21091ee2d">rechazarSolicitudPartida</a> ($datosReserva)</td></tr>
<tr class="separator:a3a6b0b33728a95357c340ce21091ee2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa03006530b93e43fc9512f5ac4b2dd69"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#aa03006530b93e43fc9512f5ac4b2dd69">filtrarReservas</a> ($datosPartida)</td></tr>
<tr class="separator:aa03006530b93e43fc9512f5ac4b2dd69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad74a3a8b077250954f7512bf6a56721b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#ad74a3a8b077250954f7512bf6a56721b">filtarPartidas</a> ($datosPartida)</td></tr>
<tr class="separator:ad74a3a8b077250954f7512bf6a56721b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb0d522f3e9778c71aecd1b65cb98725"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#acb0d522f3e9778c71aecd1b65cb98725">cambiarVista</a> ()</td></tr>
<tr class="separator:acb0d522f3e9778c71aecd1b65cb98725"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d357526edd708555e88dc28a19308d7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#a1d357526edd708555e88dc28a19308d7">cargarJuegos</a> ()</td></tr>
<tr class="separator:a1d357526edd708555e88dc28a19308d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06bcc459ae419fedd75d92959257e984"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_administrador.html#a06bcc459ae419fedd75d92959257e984">buscarNombreDirectorPartida</a> ($datosDirector)</td></tr>
<tr class="separator:a06bcc459ae419fedd75d92959257e984"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_class_usuarios_1_1_usuario"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_class_usuarios_1_1_usuario')"><img src="closed.png" alt="-"/>&#160;Métodos públicos heredados desde <a class="el" href="class_usuarios_1_1_usuario.html">Usuarios\Usuario</a></td></tr>
<tr class="memitem:a859c58316ddcbb429e340625df9fdcab inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a859c58316ddcbb429e340625df9fdcab">__construct</a> ($email)</td></tr>
<tr class="separator:a859c58316ddcbb429e340625df9fdcab inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0fcfb1e5b32f02d37437a99fb782f13 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#af0fcfb1e5b32f02d37437a99fb782f13">getEmail</a> ()</td></tr>
<tr class="separator:af0fcfb1e5b32f02d37437a99fb782f13 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35e1e252fb058b218c239496d36fc58b inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a35e1e252fb058b218c239496d36fc58b">getRol</a> ()</td></tr>
<tr class="separator:a35e1e252fb058b218c239496d36fc58b inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1f6bb19c3cf879c664cb7325c0fb6f1 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#ab1f6bb19c3cf879c664cb7325c0fb6f1">cargarDatos</a> ()</td></tr>
<tr class="separator:ab1f6bb19c3cf879c664cb7325c0fb6f1 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb1ea845f9affc738988e920242f450d inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#adb1ea845f9affc738988e920242f450d">modificarDatos</a> ()</td></tr>
<tr class="separator:adb1ea845f9affc738988e920242f450d inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa26342dedf4517f28d496ebc3167614b inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#aa26342dedf4517f28d496ebc3167614b">anadirCarrito</a> ()</td></tr>
<tr class="separator:aa26342dedf4517f28d496ebc3167614b inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4134f9fefbf2976f8a0fa258baf71145 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a4134f9fefbf2976f8a0fa258baf71145">eliminarCarrito</a> ()</td></tr>
<tr class="separator:a4134f9fefbf2976f8a0fa258baf71145 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16b536cb64bb7f1c027343231a237787 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a16b536cb64bb7f1c027343231a237787">realizarPedido</a> ()</td></tr>
<tr class="separator:a16b536cb64bb7f1c027343231a237787 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6f79c96b9f54994a34493da43c82598 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#af6f79c96b9f54994a34493da43c82598">guardarInicioSesion</a> ()</td></tr>
<tr class="separator:af6f79c96b9f54994a34493da43c82598 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a38fe0b1d2a5bf4dc73ef3735192ac9 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a8a38fe0b1d2a5bf4dc73ef3735192ac9">masInfoPartida</a> ($idPartida)</td></tr>
<tr class="separator:a8a38fe0b1d2a5bf4dc73ef3735192ac9 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e144bce530f70110571d09ecc72d110 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a6e144bce530f70110571d09ecc72d110">reservarPartida</a> ($idPartida, $email)</td></tr>
<tr class="separator:a6e144bce530f70110571d09ecc72d110 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3399bd35365062280571331f41491b5 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#af3399bd35365062280571331f41491b5">cancelarPartida</a> ()</td></tr>
<tr class="separator:af3399bd35365062280571331f41491b5 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9dc8bc5c52145d25df9c76f44981d4b inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#af9dc8bc5c52145d25df9c76f44981d4b">suscribirse</a> ($duracion)</td></tr>
<tr class="separator:af9dc8bc5c52145d25df9c76f44981d4b inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f606883d9d1e9d1b3f958f815654d2a inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a5f606883d9d1e9d1b3f958f815654d2a">cancelarRenovacionSusc</a> ()</td></tr>
<tr class="separator:a5f606883d9d1e9d1b3f958f815654d2a inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab11cf4f97e3890cf9ce7c1a44864dc8a inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#ab11cf4f97e3890cf9ce7c1a44864dc8a">cerrarSesion</a> ()</td></tr>
<tr class="separator:ab11cf4f97e3890cf9ce7c1a44864dc8a inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9d675c8bfe08db2c1d74518a0f9f638 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#af9d675c8bfe08db2c1d74518a0f9f638">cargarPerfil</a> ()</td></tr>
<tr class="separator:af9d675c8bfe08db2c1d74518a0f9f638 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fd80830b66dadea8467acfd72e8a5d2 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a5fd80830b66dadea8467acfd72e8a5d2">guardarPerfil</a> ($datos)</td></tr>
<tr class="separator:a5fd80830b66dadea8467acfd72e8a5d2 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e70fce311df048d97ccaadd02faa2c9 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a6e70fce311df048d97ccaadd02faa2c9">cargarHistorial</a> ($filtro, $propio=true)</td></tr>
<tr class="separator:a6e70fce311df048d97ccaadd02faa2c9 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc69da0200ab80f3869621bba5218540 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#abc69da0200ab80f3869621bba5218540">filtarPartidas</a> ($filtro)</td></tr>
<tr class="separator:abc69da0200ab80f3869621bba5218540 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc070103af69847d4e5db51084b9b690 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#acc070103af69847d4e5db51084b9b690">calcularNumPag</a> ($sentencia, $datos=[], $limite=7)</td></tr>
<tr class="separator:acc070103af69847d4e5db51084b9b690 inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a047f776dd5ff0f42a2f6ce96e020d82c inherit pub_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a047f776dd5ff0f42a2f6ce96e020d82c">buscarNombreJuego</a> ($nombreJuego)</td></tr>
<tr class="separator:a047f776dd5ff0f42a2f6ce96e020d82c inherit pub_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="inherited" name="inherited"></a>
Otros miembros heredados</h2></td></tr>
<tr class="inherit_header pro_methods_class_usuarios_1_1_usuario"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_class_usuarios_1_1_usuario')"><img src="closed.png" alt="-"/>&#160;Métodos protegidos heredados desde <a class="el" href="class_usuarios_1_1_usuario.html">Usuarios\Usuario</a></td></tr>
<tr class="memitem:ae3e1becc984b8ac96f4b64727127c25d inherit pro_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#ae3e1becc984b8ac96f4b64727127c25d">comprobarFechas</a> ($fecha1, $fecha2=&quot;&quot;, $soloActuales=true)</td></tr>
<tr class="separator:ae3e1becc984b8ac96f4b64727127c25d inherit pro_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f68a8bff7432ec5a602a12e9a871344 inherit pro_methods_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a3f68a8bff7432ec5a602a12e9a871344">devolverFechasPostDiaActual</a> ($fecha)</td></tr>
<tr class="separator:a3f68a8bff7432ec5a602a12e9a871344 inherit pro_methods_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_attribs_class_usuarios_1_1_usuario"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_class_usuarios_1_1_usuario')"><img src="closed.png" alt="-"/>&#160;Atributos protegidos heredados desde <a class="el" href="class_usuarios_1_1_usuario.html">Usuarios\Usuario</a></td></tr>
<tr class="memitem:afdb83293ff080f6bf306b6116eae23fd inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#afdb83293ff080f6bf306b6116eae23fd">$id_usuario</a></td></tr>
<tr class="separator:afdb83293ff080f6bf306b6116eae23fd inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a412d5f518a387e35e7a367fd0a7c330d inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a412d5f518a387e35e7a367fd0a7c330d">$email</a></td></tr>
<tr class="separator:a412d5f518a387e35e7a367fd0a7c330d inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9568fbf4b14f93b82fafae20b0a96e3c inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a9568fbf4b14f93b82fafae20b0a96e3c">$nombre</a></td></tr>
<tr class="separator:a9568fbf4b14f93b82fafae20b0a96e3c inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3963867477f2237d9dc2adbd8addb949 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a3963867477f2237d9dc2adbd8addb949">$apellidos</a></td></tr>
<tr class="separator:a3963867477f2237d9dc2adbd8addb949 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a689fd87051bcee3b0bfedde3a01ac7b9 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a689fd87051bcee3b0bfedde3a01ac7b9">$telefono</a></td></tr>
<tr class="separator:a689fd87051bcee3b0bfedde3a01ac7b9 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af398b34aba0ae769f7a81492904fda82 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#af398b34aba0ae769f7a81492904fda82">$fecha_registro</a></td></tr>
<tr class="separator:af398b34aba0ae769f7a81492904fda82 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77a10e7f92a982d48461b57a5605188f inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a77a10e7f92a982d48461b57a5605188f">$direccion</a></td></tr>
<tr class="separator:a77a10e7f92a982d48461b57a5605188f inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27cc45fe847b12fbbcd72c8eb0b72f8a inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a27cc45fe847b12fbbcd72c8eb0b72f8a">$fecha_ult_modif</a></td></tr>
<tr class="separator:a27cc45fe847b12fbbcd72c8eb0b72f8a inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a3514f3ba9fc44e09e52dfc2ffc1752 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a4a3514f3ba9fc44e09e52dfc2ffc1752">$fecha_ult_acceso</a></td></tr>
<tr class="separator:a4a3514f3ba9fc44e09e52dfc2ffc1752 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d68c5c5859cefd193f5994c7eab2ef9 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a1d68c5c5859cefd193f5994c7eab2ef9">$rol</a></td></tr>
<tr class="separator:a1d68c5c5859cefd193f5994c7eab2ef9 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57fde5ab4f6fbcc7ffc7092b4ed72f69 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a57fde5ab4f6fbcc7ffc7092b4ed72f69">$genero_favorito</a></td></tr>
<tr class="separator:a57fde5ab4f6fbcc7ffc7092b4ed72f69 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a312f3ab3e0d6b10282ba63725daba08a inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a312f3ab3e0d6b10282ba63725daba08a">$suscripcion</a></td></tr>
<tr class="separator:a312f3ab3e0d6b10282ba63725daba08a inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac46c6fd5d0aa5e7a2a75bbb0433e9a11 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#ac46c6fd5d0aa5e7a2a75bbb0433e9a11">$renovar</a></td></tr>
<tr class="separator:ac46c6fd5d0aa5e7a2a75bbb0433e9a11 inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b39120c4feb2b3da462222f2860a0bb inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_usuarios_1_1_usuario.html#a9b39120c4feb2b3da462222f2860a0bb">$fecha_ini_suscripcion</a></td></tr>
<tr class="separator:a9b39120c4feb2b3da462222f2860a0bb inherit pro_attribs_class_usuarios_1_1_usuario"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Documentación del constructor y destructor</h2>
<a id="a6603bbdc6f0c93875ec87e25022eeeb3" name="a6603bbdc6f0c93875ec87e25022eeeb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6603bbdc6f0c93875ec87e25022eeeb3">&#9670;&nbsp;</a></span>__construct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::__construct </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$email</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$rol</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   11</span>                                              {</div>
<div class="line"><span class="lineno">   12</span>        parent::__construct(<a class="code hl_variable" href="class_usuarios_1_1_usuario.html#a412d5f518a387e35e7a367fd0a7c330d">$email</a>);</div>
<div class="line"><span class="lineno">   13</span> </div>
<div class="line"><span class="lineno">   14</span>        <span class="comment">//Comprueba su rol, si no es administrador lanza un error</span></div>
<div class="line"><span class="lineno">   15</span>        $this-&gt;rol = <a class="code hl_variable" href="class_usuarios_1_1_usuario.html#a1d68c5c5859cefd193f5994c7eab2ef9">$rol</a>;</div>
<div class="line"><span class="lineno">   16</span>    }</div>
<div class="ttc" id="aclass_usuarios_1_1_usuario_html_a1d68c5c5859cefd193f5994c7eab2ef9"><div class="ttname"><a href="class_usuarios_1_1_usuario.html#a1d68c5c5859cefd193f5994c7eab2ef9">Usuarios\Usuario\$rol</a></div><div class="ttdeci">$rol</div><div class="ttdef"><b>Definition:</b> Usuario.php:23</div></div>
<div class="ttc" id="aclass_usuarios_1_1_usuario_html_a412d5f518a387e35e7a367fd0a7c330d"><div class="ttname"><a href="class_usuarios_1_1_usuario.html#a412d5f518a387e35e7a367fd0a7c330d">Usuarios\Usuario\$email</a></div><div class="ttdeci">$email</div><div class="ttdef"><b>Definition:</b> Usuario.php:15</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Documentación de las funciones miembro</h2>
<a id="a6ebf9a3463ba2fb24d200175247612d2" name="a6ebf9a3463ba2fb24d200175247612d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ebf9a3463ba2fb24d200175247612d2">&#9670;&nbsp;</a></span>aceptarSolicitudPartida()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::aceptarSolicitudPartida </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datosReserva</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Acepta la solicitud de reserva del usuairo</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$datosReserva</td><td>Array con los datos a agregar en la consulta (id_partida e usuario)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>void No devuelve nada </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  348</span>                                                            {</div>
<div class="line"><span class="lineno">  349</span>        $this-&gt;validarCamposForm($datosReserva);</div>
<div class="line"><span class="lineno">  350</span>        <span class="comment">//Convertimos el id  a int ya que como viene de json viene como string</span></div>
<div class="line"><span class="lineno">  351</span>        $datosReserva[<span class="stringliteral">&quot;id_partida&quot;</span>] = intval($datosReserva[<span class="stringliteral">&quot;id_partida&quot;</span>]);</div>
<div class="line"><span class="lineno">  352</span>        <span class="comment">//Instanciamos bd</span></div>
<div class="line"><span class="lineno">  353</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  354</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  355</span>            <span class="comment">//Iniciamos una transacción manual</span></div>
<div class="line"><span class="lineno">  356</span>            $pdo = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;iniciarTransaccionManual();</div>
<div class="line"><span class="lineno">  357</span>            <span class="comment">//Relizamos una consulta para coger los datos de la partida</span></div>
<div class="line"><span class="lineno">  358</span>            $sentencia = <span class="stringliteral">&quot;SELECT P.fecha, P.hora_inicio, P.duracion, PR.nombre as juego FROM partidas AS P INNER JOIN productos AS PR ON P.id_partida = :id_partida AND P.juego_partida = PR.id_producto;&quot;</span>;</div>
<div class="line"><span class="lineno">  359</span>            $pdoStatement = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;recuperarDatosBDNum($sentencia, [<span class="stringliteral">&quot;id_partida&quot;</span> =&gt; $datosReserva[<span class="stringliteral">&quot;id_partida&quot;</span>]]);</div>
<div class="line"><span class="lineno">  360</span>            <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">  361</span>                <span class="keywordflow">throw</span> new \PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  362</span>            }</div>
<div class="line"><span class="lineno">  363</span>            <a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a> = $pdoStatement-&gt;fetch(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  364</span>            <span class="keywordflow">if</span>(empty(<a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a>)){</div>
<div class="line"><span class="lineno">  365</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&quot;No existe esa partida&quot;</span>);</div>
<div class="line"><span class="lineno">  366</span>            }</div>
<div class="line"><span class="lineno">  367</span>            <span class="comment">//Sentencia para hacer update</span></div>
<div class="line"><span class="lineno">  368</span>            $sentencia = <span class="stringliteral">&quot;UPDATE usuarios_partidas SET reservada = 1 WHERE partida = :id_partida AND usuario = :usuario;&quot;</span>;</div>
<div class="line"><span class="lineno">  369</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;agregarModificarDatosBDNum($sentencia, $datosReserva);</div>
<div class="line"><span class="lineno">  370</span>            <span class="keywordflow">if</span>(is_string(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>) &amp;&amp; stripos(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>, <span class="stringliteral">&quot;error&quot;</span>) !== <span class="keyword">false</span>){</div>
<div class="line"><span class="lineno">  371</span>                <span class="keywordflow">throw</span> new \PDOException(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>);</div>
<div class="line"><span class="lineno">  372</span>            }</div>
<div class="line"><span class="lineno">  373</span>            <span class="comment">//Si llegó hasta aquí es que se realizó con éxito por lo que enviamos el correo</span></div>
<div class="line"><span class="lineno">  374</span>            <a class="code hl_variable" href="class_usuarios_1_1_usuario.html#a412d5f518a387e35e7a367fd0a7c330d">$email</a> = <span class="keyword">new</span> mail();</div>
<div class="line"><span class="lineno">  375</span>            <span class="comment">//Añadimos a datos que ha sido aceptada</span></div>
<div class="line"><span class="lineno">  376</span>            <a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a>[<span class="stringliteral">&quot;aceptada&quot;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  377</span>            $correoEnviado = <a class="code hl_variable" href="class_usuarios_1_1_usuario.html#a412d5f518a387e35e7a367fd0a7c330d">$email</a>-&gt;enviarCorreos($datosReserva[<span class="stringliteral">&quot;usuario&quot;</span>], <span class="stringliteral">&quot;reserva&quot;</span>, <a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a>);</div>
<div class="line"><span class="lineno">  378</span>            <span class="keywordflow">if</span>($correoEnviado !== <span class="keyword">true</span>) {</div>
<div class="line"><span class="lineno">  379</span>                <span class="keywordflow">throw</span> new \Exception($correoEnviado);</div>
<div class="line"><span class="lineno">  380</span>            }</div>
<div class="line"><span class="lineno">  381</span>            $pdo-&gt;commit();</div>
<div class="line"><span class="lineno">  382</span>        }</div>
<div class="line"><span class="lineno">  383</span>        <span class="keywordflow">catch</span> (\PDOException $pdoError){</div>
<div class="line"><span class="lineno">  384</span>            $pdo-&gt;rollBack();</div>
<div class="line"><span class="lineno">  385</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  386</span>        }</div>
<div class="line"><span class="lineno">  387</span>        <span class="keywordflow">catch</span>(\Exception $error){</div>
<div class="line"><span class="lineno">  388</span>            $pdo-&gt;rollBack();</div>
<div class="line"><span class="lineno">  389</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  390</span>        }</div>
<div class="line"><span class="lineno">  391</span>    }</div>
<div class="ttc" id="acaja_sorpresa_8php_html_acc3591d1c0945e5b934207901d1e06c0"><div class="ttname"><a href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a></div><div class="ttdeci">$bd</div><div class="ttdef"><b>Definition:</b> cajaSorpresa.php:9</div></div>
<div class="ttc" id="aregistro_8php_html_a8a19dd5c98c023a74c45bfbed55e9674"><div class="ttname"><a href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a></div><div class="ttdeci">$datos</div><div class="ttdef"><b>Definition:</b> registro.php:6</div></div>
<div class="ttc" id="asuscripciones_8php_html_a06face0ef35c41554d8f4fe115363f58"><div class="ttname"><a href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a></div><div class="ttdeci">$resultado</div><div class="ttdef"><b>Definition:</b> suscripciones.php:83</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a06bcc459ae419fedd75d92959257e984" name="a06bcc459ae419fedd75d92959257e984"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06bcc459ae419fedd75d92959257e984">&#9670;&nbsp;</a></span>buscarNombreDirectorPartida()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::buscarNombreDirectorPartida </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datosDirector</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  603</span>                                                                {</div>
<div class="line"><span class="lineno">  604</span>        <span class="comment">//Validamos el campo</span></div>
<div class="line"><span class="lineno">  605</span>        $this-&gt;validarCamposForm($datosDirectr);</div>
<div class="line"><span class="lineno">  606</span>        <span class="comment">//Instanciamos bdo</span></div>
<div class="line"><span class="lineno">  607</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  608</span>        <span class="comment">//Creamos la sentencia</span></div>
<div class="line"><span class="lineno">  609</span>        $sentencia = <span class="stringliteral">&quot;SELECT email as nombre  FROM usuarios WHERE rol = 1 AND email LIKE ? LIMIT 0, 5&quot;</span>;</div>
<div class="line"><span class="lineno">  610</span>        $datosAsignar = [<span class="stringliteral">&quot;%&quot;</span> . $datosDirector . <span class="stringliteral">&quot;%&quot;</span>];</div>
<div class="line"><span class="lineno">  611</span>        <span class="comment">//Pasamos el dato a un array para enviarselo a la función</span></div>
<div class="line"><span class="lineno">  612</span>        $pdoStatement = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;recuperDatosBD($sentencia, $datosAsignar);</div>
<div class="line"><span class="lineno">  613</span>        <span class="comment">//Comprobamos que nos devolviera un PDOStatement</span></div>
<div class="line"><span class="lineno">  614</span>        <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">  615</span>            <span class="keywordflow">throw</span> new \PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  616</span>        }</div>
<div class="line"><span class="lineno">  617</span>        <span class="comment">//Hacemos fetchAll ya que la búsqueda está limitada a 5 como mucho</span></div>
<div class="line"><span class="lineno">  618</span>        $director_partida = $pdoStatement-&gt;fetchAll(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  619</span>        <span class="keywordflow">return</span> $director_partida;</div>
<div class="line"><span class="lineno">  620</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa120a4645e7bd0b4c74b10cd7156afa7" name="aa120a4645e7bd0b4c74b10cd7156afa7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa120a4645e7bd0b4c74b10cd7156afa7">&#9670;&nbsp;</a></span>cambiarRol()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::cambiarRol </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$usuario</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$rolActual</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Cambia el rol del usuario</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$usuario</td><td>Email del usuario </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$rolActual</td><td>Rol actual</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>mixed String con el error o 0 </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   97</span>                                                    {</div>
<div class="line"><span class="lineno">   98</span>        <span class="comment">//Instanciamos BD</span></div>
<div class="line"><span class="lineno">   99</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  100</span>        <span class="comment">//Creamos una sentencia que cambie el rol del usuario elegido por el rol seleccionado</span></div>
<div class="line"><span class="lineno">  101</span>        $sentencia = <span class="stringliteral">&quot;UPDATE usuarios SET rol = :rol WHERE email = :email&quot;</span>;</div>
<div class="line"><span class="lineno">  102</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;rol&quot;</span>] = intval($rolActual);</div>
<div class="line"><span class="lineno">  103</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>[<span class="stringliteral">&quot;email&quot;</span>] = <a class="code hl_variable" href="partidas_8php.html#a559c8003f481610caf373b85cc607fb6">$usuario</a>;</div>
<div class="line"><span class="lineno">  104</span>        <span class="comment">// Ahora intentamos hacer el cambio</span></div>
<div class="line"><span class="lineno">  105</span>        <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;agregarModificarDatosBDNum($sentencia, <a class="code hl_variable" href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a>);</div>
<div class="line"><span class="lineno">  106</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>;</div>
<div class="line"><span class="lineno">  107</span>    }</div>
<div class="ttc" id="acaja_sorpresa_8php_html_a6b32d1257bd00df02f59ecfdbac9a439"><div class="ttname"><a href="caja_sorpresa_8php.html#a6b32d1257bd00df02f59ecfdbac9a439">$datosUsuario</a></div><div class="ttdeci">$datosUsuario</div><div class="ttdef"><b>Definition:</b> cajaSorpresa.php:7</div></div>
<div class="ttc" id="apartidas_8php_html_a559c8003f481610caf373b85cc607fb6"><div class="ttname"><a href="partidas_8php.html#a559c8003f481610caf373b85cc607fb6">$usuario</a></div><div class="ttdeci">$usuario</div><div class="ttdef"><b>Definition:</b> partidas.php:11</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acb0d522f3e9778c71aecd1b65cb98725" name="acb0d522f3e9778c71aecd1b65cb98725"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb0d522f3e9778c71aecd1b65cb98725">&#9670;&nbsp;</a></span>cambiarVista()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::cambiarVista </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  575</span>                                  { <span class="comment">// alternar entre vista del panel de control y vista estándar</span></div>
<div class="line"><span class="lineno">  576</span> </div>
<div class="line"><span class="lineno">  577</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="afcdc7ed29ee6860c11b656457010ed50" name="afcdc7ed29ee6860c11b656457010ed50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcdc7ed29ee6860c11b656457010ed50">&#9670;&nbsp;</a></span>cargarHistorial()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::cargarHistorial </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filtro</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$propio</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Carga el historial del usuario</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$filtro</td><td>Filtros que se le asignan </td></tr>
    <tr><td class="paramtype">boolean</td><td class="paramname">$propio</td><td>Si es sólo nuestro perfil o no</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>array Número de página y los datos del historial </dd></dl>

<p>Reimplementado de <a class="el" href="class_usuarios_1_1_usuario.html#a6e70fce311df048d97ccaadd02faa2c9">Usuarios\Usuario</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   26</span>                                                                 {</div>
<div class="line"><span class="lineno">   27</span>            <span class="comment">//Comprobamos que las fechas no sean null</span></div>
<div class="line"><span class="lineno">   28</span>            $fecha1 = $filtro[<span class="stringliteral">&quot;fechaIni&quot;</span>] ?? <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">   29</span>            $fecha2 = $filtro[<span class="stringliteral">&quot;fechaFin&quot;</span>] ?? <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">   30</span>            $fechas = $this-&gt;<a class="code hl_function" href="class_usuarios_1_1_usuario.html#ae3e1becc984b8ac96f4b64727127c25d">comprobarFechas</a>($fecha1, $fecha2, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">   31</span>            $datosFiltrado = [];</div>
<div class="line"><span class="lineno">   32</span>            <span class="comment">//Si es el propio</span></div>
<div class="line"><span class="lineno">   33</span>            <span class="keywordflow">if</span>($propio){</div>
<div class="line"><span class="lineno">   34</span>                $datosFiltrado[<span class="stringliteral">&quot;email&quot;</span>] = $this-&gt;<a class="code hl_function" href="class_usuarios_1_1_usuario.html#af0fcfb1e5b32f02d37437a99fb782f13">getEmail</a>();</div>
<div class="line"><span class="lineno">   35</span>                <span class="comment">//Instanciamos bd</span></div>
<div class="line"><span class="lineno">   36</span>                <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">   37</span>                <span class="comment">//Sentencia</span></div>
<div class="line"><span class="lineno">   38</span>                $sentenciaNumPag = <span class="stringliteral">&quot;SELECT count(*) as num_pag FROM historico_usuarios WHERE email = :email&quot;</span>;</div>
<div class="line"><span class="lineno">   39</span>                $sentencia = <span class="stringliteral">&quot;SELECT fecha_ult_modif, CONCAT(&#39;email:&#39;,email , &#39;; &#39;, &#39;rol:&#39;,rol, &#39;; &#39;, &#39;nombre:&#39;,nombre, &#39;; &#39;, &#39;apellidos:&#39;,apellidos, &#39;; &#39;, &#39;telefono:&#39;, IFNULL(telefono, &#39;&#39;), &#39;; &#39;, &#39;direccion:&#39;, IFNULL(direccion, &#39;&#39;), &#39;; &#39;, &#39;genero_favorito:&#39;, IFNULL(genero_favorito, &#39;&#39;), &#39;; &#39;, &#39;suscripcion:&#39;, IFNULL(suscripcion, &#39;&#39;), &#39;; &#39;, &#39;renovar:&#39;, IFNULL(renovar, &#39;&#39;)) AS datos FROM historico_usuarios WHERE email = :email&quot;</span>;</div>
<div class="line"><span class="lineno">   40</span>                <span class="comment">//Comprobamos si cogemos las fechas</span></div>
<div class="line"><span class="lineno">   41</span>                <span class="keywordflow">if</span>(count($fechas) == 2){</div>
<div class="line"><span class="lineno">   42</span>                    $sentenciaNumPag .= <span class="stringliteral">&quot; AND (DATE(fecha_ult_modif) BETWEEN :fechaIni AND :fechaFin)&quot;</span>;</div>
<div class="line"><span class="lineno">   43</span>                    $sentencia .= <span class="stringliteral">&quot; AND (DATE(fecha_ult_modif) BETWEEN :fechaIni AND :fechaFin)&quot;</span>;</div>
<div class="line"><span class="lineno">   44</span>                    $datosFiltrado[<span class="stringliteral">&quot;fechaIni&quot;</span>] = $filtro[<span class="stringliteral">&quot;fechaIni&quot;</span>];</div>
<div class="line"><span class="lineno">   45</span>                    $datosFiltrado[<span class="stringliteral">&quot;fechaFin&quot;</span>] = $filtro[<span class="stringliteral">&quot;fechaFin&quot;</span>];</div>
<div class="line"><span class="lineno">   46</span>                }</div>
<div class="line"><span class="lineno">   47</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(count($fechas) == 1){</div>
<div class="line"><span class="lineno">   48</span>                    $sentenciaNumPag .= <span class="stringliteral">&quot; AND (DATE(fecha_ult_modif) &gt;= :fechaIni)&quot;</span>;</div>
<div class="line"><span class="lineno">   49</span>                    $sentencia .= <span class="stringliteral">&quot; AND (DATE(fecha_ult_modif) &gt;= :fechaIni)&quot;</span>;</div>
<div class="line"><span class="lineno">   50</span>                    $datosFiltrado[<span class="stringliteral">&quot;fechaIni&quot;</span>] = $filtro[<span class="stringliteral">&quot;fechaIni&quot;</span>];</div>
<div class="line"><span class="lineno">   51</span>                }</div>
<div class="line"><span class="lineno">   52</span>            }</div>
<div class="line"><span class="lineno">   53</span>            <span class="comment">//Si es el del otro</span></div>
<div class="line"><span class="lineno">   54</span>            <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   55</span>                <span class="comment">//Instanciamos bd</span></div>
<div class="line"><span class="lineno">   56</span>                <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">   57</span>                <span class="comment">//Sentencia</span></div>
<div class="line"><span class="lineno">   58</span>                $sentenciaNumPag = <span class="stringliteral">&quot;SELECT count(*) as num_pag FROM historico_usuarios&quot;</span>;</div>
<div class="line"><span class="lineno">   59</span>                $sentencia = <span class="stringliteral">&quot;SELECT fecha_ult_modif, CONCAT(&#39;email:&#39;,email , &#39;; &#39;, &#39;rol:&#39;,rol, &#39;; &#39;, &#39;nombre:&#39;,nombre, &#39;; &#39;, &#39;apellidos:&#39;,apellidos, &#39;; &#39;, &#39;telefono:&#39;, IFNULL(telefono, &#39;&#39;), &#39;; &#39;, &#39;direccion:&#39;, IFNULL(direccion, &#39;&#39;), &#39;; &#39;, &#39;genero_favorito:&#39;, IFNULL(genero_favorito, &#39;&#39;), &#39;; &#39;, &#39;suscripcion:&#39;, IFNULL(suscripcion, &#39;&#39;), &#39;; &#39;, &#39;renovar:&#39;, IFNULL(renovar, &#39;&#39;)) AS datos FROM historico_usuarios&quot;</span>;</div>
<div class="line"><span class="lineno">   60</span>                <span class="comment">//Comprobamos si cogemos las fechas</span></div>
<div class="line"><span class="lineno">   61</span>                <span class="keywordflow">if</span>(count($fechas) == 2){</div>
<div class="line"><span class="lineno">   62</span>                    $sentenciaNumPag .= <span class="stringliteral">&quot; WHERE DATE(fecha_ult_modif) BETWEEN :fechaIni AND :fechaFin&quot;</span>;</div>
<div class="line"><span class="lineno">   63</span>                    $sentencia .= <span class="stringliteral">&quot; WHERE DATE(fecha_ult_modif) BETWEEN :fechaIni AND :fechaFin&quot;</span>;</div>
<div class="line"><span class="lineno">   64</span>                    $datosFiltrado[<span class="stringliteral">&quot;fechaIni&quot;</span>] = $filtro[<span class="stringliteral">&quot;fechaIni&quot;</span>];</div>
<div class="line"><span class="lineno">   65</span>                    $datosFiltrado[<span class="stringliteral">&quot;fechaFin&quot;</span>] = $filtro[<span class="stringliteral">&quot;fechaFin&quot;</span>];</div>
<div class="line"><span class="lineno">   66</span>                }</div>
<div class="line"><span class="lineno">   67</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(count($fechas) == 1){</div>
<div class="line"><span class="lineno">   68</span>                    $sentenciaNumPag .= <span class="stringliteral">&quot; WHERE DATE(fecha_ult_modif) &gt;= :fechaIni&quot;</span>;</div>
<div class="line"><span class="lineno">   69</span>                    $sentencia .= <span class="stringliteral">&quot; WHERE DATE(fecha_ult_modif) &gt;= :fechaIni&quot;</span>;</div>
<div class="line"><span class="lineno">   70</span>                    $datosFiltrado[<span class="stringliteral">&quot;fechaIni&quot;</span>] = $filtro[<span class="stringliteral">&quot;fechaIni&quot;</span>];</div>
<div class="line"><span class="lineno">   71</span>                }</div>
<div class="line"><span class="lineno">   72</span>            }</div>
<div class="line"><span class="lineno">   73</span>            <span class="comment">//Calculamos el número de página</span></div>
<div class="line"><span class="lineno">   74</span>            $numPag = $this-&gt;<a class="code hl_function" href="class_usuarios_1_1_usuario.html#acc070103af69847d4e5db51084b9b690">calcularNumPag</a>($sentenciaNumPag, $datosFiltrado);</div>
<div class="line"><span class="lineno">   75</span>            <span class="comment">//Añadimos el limite</span></div>
<div class="line"><span class="lineno">   76</span>            $sentencia .= <span class="stringliteral">&quot; LIMIT :pagina, :limite;&quot;</span>;</div>
<div class="line"><span class="lineno">   77</span>            $datosFiltrado[<span class="stringliteral">&quot;pagina&quot;</span>] = intval($filtro[<span class="stringliteral">&quot;pagina&quot;</span>]);</div>
<div class="line"><span class="lineno">   78</span>            $datosFiltrado[<span class="stringliteral">&quot;limite&quot;</span>] = intval($filtro[<span class="stringliteral">&quot;limite&quot;</span>]);</div>
<div class="line"><span class="lineno">   79</span>            <span class="comment">//Cogemos los datos</span></div>
<div class="line"><span class="lineno">   80</span>            $pdoStatement = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;recuperarDatosBDNum($sentencia, $datosFiltrado);</div>
<div class="line"><span class="lineno">   81</span>            <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">   82</span>                <span class="keywordflow">throw</span> new \PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">   83</span>            }</div>
<div class="line"><span class="lineno">   84</span>            <span class="comment">//Cogemos todas las tuplas</span></div>
<div class="line"><span class="lineno">   85</span>            $historial = $pdoStatement-&gt;fetchAll(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">   86</span>            <span class="keywordflow">return</span> [<span class="stringliteral">&quot;numPag&quot;</span> =&gt; $numPag, <span class="stringliteral">&quot;historial&quot;</span> =&gt; $historial];</div>
<div class="line"><span class="lineno">   87</span>        }</div>
<div class="ttc" id="aclass_usuarios_1_1_usuario_html_acc070103af69847d4e5db51084b9b690"><div class="ttname"><a href="class_usuarios_1_1_usuario.html#acc070103af69847d4e5db51084b9b690">Usuarios\Usuario\calcularNumPag</a></div><div class="ttdeci">calcularNumPag($sentencia, $datos=[], $limite=7)</div><div class="ttdef"><b>Definition:</b> Usuario.php:443</div></div>
<div class="ttc" id="aclass_usuarios_1_1_usuario_html_ae3e1becc984b8ac96f4b64727127c25d"><div class="ttname"><a href="class_usuarios_1_1_usuario.html#ae3e1becc984b8ac96f4b64727127c25d">Usuarios\Usuario\comprobarFechas</a></div><div class="ttdeci">comprobarFechas($fecha1, $fecha2=&quot;&quot;, $soloActuales=true)</div><div class="ttdef"><b>Definition:</b> Usuario.php:473</div></div>
<div class="ttc" id="aclass_usuarios_1_1_usuario_html_af0fcfb1e5b32f02d37437a99fb782f13"><div class="ttname"><a href="class_usuarios_1_1_usuario.html#af0fcfb1e5b32f02d37437a99fb782f13">Usuarios\Usuario\getEmail</a></div><div class="ttdeci">getEmail()</div><div class="ttdef"><b>Definition:</b> Usuario.php:42</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1d357526edd708555e88dc28a19308d7" name="a1d357526edd708555e88dc28a19308d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d357526edd708555e88dc28a19308d7">&#9670;&nbsp;</a></span>cargarJuegos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::cargarJuegos </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Carga 100 juegos (En el futuro se ampliará para poder cargar todos pero en tandas)</p>
<dl class="section return"><dt>Devuelve</dt><dd>mixed PDOStament o error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  585</span>                                   {</div>
<div class="line"><span class="lineno">  586</span>        <span class="comment">//Instancio bd</span></div>
<div class="line"><span class="lineno">  587</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  588</span>        <span class="comment">//Sentenica para pedir los juegos, limitamos a 100 para tener un número controlado y poder hacer fetch all, ya el número de juegos no se puede controlar</span></div>
<div class="line"><span class="lineno">  589</span>        <span class="comment">//En el futuro plantearemos una forma más eficiente de buscar los juegos que pueda ir mostrando a pocos todos los juegos para seleccionar el adecuado, ya que esto haría que no se vieran todos los juegos si hay muchos</span></div>
<div class="line"><span class="lineno">  590</span>        $sentencia = <span class="stringliteral">&quot;SELECT P.id_producto, P.nombre FROM productos as P INNER JOIN juegos as J ON P.id_producto = J.juego LIMIT 0, 100;&quot;</span>;</div>
<div class="line"><span class="lineno">  591</span>        <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;recuperDatosBD($sentencia);</div>
<div class="line"><span class="lineno">  592</span>        <span class="keywordflow">if</span>(!<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">  593</span>            <span class="keywordflow">throw</span> new \PDOException(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>);</div>
<div class="line"><span class="lineno">  594</span>        }</div>
<div class="line"><span class="lineno">  595</span>        <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>-&gt;fetchAll(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  596</span>        <span class="keywordflow">if</span>(!<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>){</div>
<div class="line"><span class="lineno">  597</span>            <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&quot;No hay ningún juego&quot;</span>);</div>
<div class="line"><span class="lineno">  598</span>        }</div>
<div class="line"><span class="lineno">  599</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>;</div>
<div class="line"><span class="lineno">  600</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a671a52fb77048bc4a5e5e3bc9944635d" name="a671a52fb77048bc4a5e5e3bc9944635d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a671a52fb77048bc4a5e5e3bc9944635d">&#9670;&nbsp;</a></span>cargarUsuarios()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::cargarUsuarios </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filtroUsuario</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Carga los usuairos y las páginas que necesitará mostrar</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$filtroUsuario</td><td>Array asociativo con los datos a filtrar , como mínimo tendrá página y filtro</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>array Array con los datos conseguidos </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  116</span>                                                   {</div>
<div class="line"><span class="lineno">  117</span>        <span class="comment">//Instanciamos bd</span></div>
<div class="line"><span class="lineno">  118</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  119</span>        <span class="comment">//Creamos la sentencia</span></div>
<div class="line"><span class="lineno">  120</span>        $sentenciaNumPag = <span class="stringliteral">&quot;SELECT COUNT(email) as num_pag FROM usuarios&quot;</span>;</div>
<div class="line"><span class="lineno">  121</span>        $sentencia = <span class="stringliteral">&quot;SELECT email, rol FROM usuarios&quot;</span>;</div>
<div class="line"><span class="lineno">  122</span>        $datosFiltrado = [];</div>
<div class="line"><span class="lineno">  123</span>        <span class="comment">//Comprobamos los filtros que puede tener</span></div>
<div class="line"><span class="lineno">  124</span>        <span class="keywordflow">if</span>(isset($filtroUsuario[<span class="stringliteral">&quot;email&quot;</span>])){</div>
<div class="line"><span class="lineno">  125</span>            $sentenciaNumPag .= <span class="stringliteral">&quot; WHERE email LIKE :email&quot;</span>;</div>
<div class="line"><span class="lineno">  126</span>            $sentencia .= <span class="stringliteral">&quot; WHERE email LIKE :email&quot;</span>;</div>
<div class="line"><span class="lineno">  127</span>            $datosFiltrado[<span class="stringliteral">&quot;email&quot;</span>] = <span class="stringliteral">&quot;%&quot;</span> . $filtroUsuario[<span class="stringliteral">&quot;email&quot;</span>] . <span class="stringliteral">&quot;%&quot;</span>;</div>
<div class="line"><span class="lineno">  128</span>        }</div>
<div class="line"><span class="lineno">  129</span>        <span class="keywordflow">if</span>(!empty($filtroUsuario[<span class="stringliteral">&quot;rol&quot;</span>])) {</div>
<div class="line"><span class="lineno">  130</span>            $sentenciaNumPag .= isset(($filtroUsuario[<span class="stringliteral">&quot;email&quot;</span>])) ? <span class="stringliteral">&quot; AND rol = :rol&quot;</span> : <span class="stringliteral">&quot; WHERE rol = :rol&quot;</span>;</div>
<div class="line"><span class="lineno">  131</span>            $sentencia .= isset(($filtroUsuario[<span class="stringliteral">&quot;email&quot;</span>])) ? <span class="stringliteral">&quot; AND rol = :rol&quot;</span> : <span class="stringliteral">&quot; WHERE rol = :rol&quot;</span>;</div>
<div class="line"><span class="lineno">  132</span>            $datosFiltrado[<span class="stringliteral">&quot;rol&quot;</span>] = intval($filtroUsuario[<span class="stringliteral">&quot;rol&quot;</span>]);</div>
<div class="line"><span class="lineno">  133</span>        }</div>
<div class="line"><span class="lineno">  134</span>        <span class="comment">//Calculamos el número de la página</span></div>
<div class="line"><span class="lineno">  135</span>        $numPag = $this-&gt;<a class="code hl_function" href="class_usuarios_1_1_usuario.html#acc070103af69847d4e5db51084b9b690">calcularNumPag</a>($sentenciaNumPag, $datosFiltrado, 7);</div>
<div class="line"><span class="lineno">  136</span>        <span class="comment">//LE ponemos el limite</span></div>
<div class="line"><span class="lineno">  137</span>        $sentencia .= <span class="stringliteral">&quot; LIMIT :pagina, :limite&quot;</span>;</div>
<div class="line"><span class="lineno">  138</span>        $datosFiltrado[<span class="stringliteral">&quot;pagina&quot;</span>] = intval($filtroUsuario[<span class="stringliteral">&quot;pagina&quot;</span>]);</div>
<div class="line"><span class="lineno">  139</span>        $datosFiltrado[<span class="stringliteral">&quot;limite&quot;</span>] = intval($filtroUsuario[<span class="stringliteral">&quot;limite&quot;</span>]);</div>
<div class="line"><span class="lineno">  140</span>        <span class="comment">//Calculamos los usuarios</span></div>
<div class="line"><span class="lineno">  141</span>        $pdoStatement = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;recuperarDatosBDNum($sentencia, $datosFiltrado);</div>
<div class="line"><span class="lineno">  142</span>        <span class="comment">//Comprobamos que no diera error</span></div>
<div class="line"><span class="lineno">  143</span>        <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">  144</span>            <span class="keywordflow">throw</span> new \PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  145</span>        }</div>
<div class="line"><span class="lineno">  146</span>        <span class="comment">//Cogemos todos los datos porque tiene le límite (sólo devolvera limite tuplas)</span></div>
<div class="line"><span class="lineno">  147</span>        $datosUsuarios = $pdoStatement-&gt;fetchAll(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  148</span>        <span class="keywordflow">return</span> [<span class="stringliteral">&quot;numPag&quot;</span> =&gt; $numPag, <span class="stringliteral">&quot;datosUsuarios&quot;</span> =&gt; $datosUsuarios];</div>
<div class="line"><span class="lineno">  149</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5f7a1bdbc8b625a8c7266196938e8113" name="a5f7a1bdbc8b625a8c7266196938e8113"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f7a1bdbc8b625a8c7266196938e8113">&#9670;&nbsp;</a></span>crearPartida()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::crearPartida </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datosPartida</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$imagenesPartida</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Crea una partida</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$datosPartida</td><td>Datos de la partida </td></tr>
    <tr><td class="paramtype"></td><td class="paramname">$_FILE</td><td>$imagenPartida Archivo a subir</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>bool Si se creo la partida con éxito </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  172</span>                                                                 {</div>
<div class="line"><span class="lineno">  173</span>        <span class="comment">//Primero validamos los datos que nos pasaron en datosPartida</span></div>
<div class="line"><span class="lineno">  174</span>        $this-&gt;validarCamposForm($datosPartida);</div>
<div class="line"><span class="lineno">  175</span>        <span class="comment">//Instanciamos bd</span></div>
<div class="line"><span class="lineno">  176</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  177</span>       <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  178</span>            <span class="comment">//Empezamos la transaccion</span></div>
<div class="line"><span class="lineno">  179</span>            $pdo = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;iniciarTransaccionManual();</div>
<div class="line"><span class="lineno">  180</span>            <span class="comment">//Movemos la imagen</span></div>
<div class="line"><span class="lineno">  181</span>            $carpetaFichero = dirname(__FILE__, 3) . DIRECTORY_SEPARATOR . <span class="stringliteral">&quot;img&quot;</span> . DIRECTORY_SEPARATOR . <span class="stringliteral">&quot;partidas&quot;</span>;</div>
<div class="line"><span class="lineno">  182</span>            $rutaImagenes = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;gestionarFichero($imagenesPartida, $carpetaFichero);</div>
<div class="line"><span class="lineno">  183</span>            <span class="keywordflow">if</span>(is_string($rutaImagenes) &amp;&amp; stripos($rutaImagenes, <span class="stringliteral">&quot;error&quot;</span>) !== <span class="keyword">false</span>) {</div>
<div class="line"><span class="lineno">  184</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&quot;No se pudo mover el archivo&quot;</span>);</div>
<div class="line"><span class="lineno">  185</span>            }</div>
<div class="line"><span class="lineno">  186</span>            <span class="comment">//Sentencia para crear la partida</span></div>
<div class="line"><span class="lineno">  187</span>            $sentencia = <span class="stringliteral">&quot;INSERT INTO partidas (plazas_min, plazas_totales,fecha, hora_inicio, duracion, director_partida, juego_partida) VALUES (:plazas_min, :plazas_totales,:fecha, :hora_inicio, :duracion, :director_partida, :juego_partida)&quot;</span>;</div>
<div class="line"><span class="lineno">  188</span>            $sentencia2 = <span class="stringliteral">&quot;INSERT INTO partidas_imagenes (partida, imagen) VALUES&quot;</span>;</div>
<div class="line"><span class="lineno">  189</span>            <span class="comment">//Guardamos la ruta relativa de cada una de las imágenes y añadimos las lineas de la sentencia</span></div>
<div class="line"><span class="lineno">  190</span>            <span class="keywordflow">foreach</span>($imagenesPartida[<span class="stringliteral">&quot;name&quot;</span>] as $indice =&gt; $nombreImagen){</div>
<div class="line"><span class="lineno">  191</span>                $datosImagenPartida[<span class="stringliteral">&quot;imagen&quot;</span> . $indice] = <span class="stringliteral">&quot;..&quot;</span> . DIRECTORY_SEPARATOR . <span class="stringliteral">&quot;img&quot;</span> . DIRECTORY_SEPARATOR . <span class="stringliteral">&quot;partidas&quot;</span> . DIRECTORY_SEPARATOR . $nombreImagen;</div>
<div class="line"><span class="lineno">  192</span>                $sentencia2 .= <span class="stringliteral">&quot; (:partida, :imagen$indice),&quot;</span>;</div>
<div class="line"><span class="lineno">  193</span>            }</div>
<div class="line"><span class="lineno">  194</span>            <span class="comment">//Añadimos el indice de la partida</span></div>
<div class="line"><span class="lineno">  195</span>            <span class="comment">//Quitamos la última coma</span></div>
<div class="line"><span class="lineno">  196</span>            $sentencia2 = substr($sentencia2, 0, -1);</div>
<div class="line"><span class="lineno">  197</span>            <span class="comment">//Añadimos a los datos del director</span></div>
<div class="line"><span class="lineno">  198</span>            $datosPartida[<span class="stringliteral">&quot;director_partida&quot;</span>] = $this-&gt;<a class="code hl_function" href="class_usuarios_1_1_usuario.html#af0fcfb1e5b32f02d37437a99fb782f13">getEmail</a>();</div>
<div class="line"><span class="lineno">  199</span>            <span class="comment">//Realizamos la primera sentencia</span></div>
<div class="line"><span class="lineno">  200</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;agregarModificarDatosBDNum($sentencia, $datosPartida, $pdo);</div>
<div class="line"><span class="lineno">  201</span>            <span class="comment">//Comprobamos que fuera un éxito</span></div>
<div class="line"><span class="lineno">  202</span>            <span class="keywordflow">if</span>(is_string(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>) &amp;&amp; stripos(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>, <span class="stringliteral">&quot;error&quot;</span>) !== <span class="keyword">false</span>){</div>
<div class="line"><span class="lineno">  203</span>                <span class="keywordflow">throw</span> new \Exception(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>);</div>
<div class="line"><span class="lineno">  204</span>            }</div>
<div class="line"><span class="lineno">  205</span>            <span class="comment">//Si no es un error $resultado el es indice de la inserción</span></div>
<div class="line"><span class="lineno">  206</span>            $datosImagenPartida[<span class="stringliteral">&quot;partida&quot;</span>] = intval(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>);</div>
<div class="line"><span class="lineno">  207</span>            <span class="comment">//Realizamos la segunda sentencia</span></div>
<div class="line"><span class="lineno">  208</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;agregarModificarDatosBDNum($sentencia2, $datosImagenPartida, $pdo);</div>
<div class="line"><span class="lineno">  209</span>            <span class="comment">//Comprobamos que fuera un éxito</span></div>
<div class="line"><span class="lineno">  210</span>            <span class="keywordflow">if</span>(is_string(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>) &amp;&amp; stripos(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>, <span class="stringliteral">&quot;error&quot;</span>) !== <span class="keyword">false</span>){</div>
<div class="line"><span class="lineno">  211</span>                <span class="keywordflow">throw</span> new \Exception(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>);</div>
<div class="line"><span class="lineno">  212</span>            }</div>
<div class="line"><span class="lineno">  213</span>            <span class="comment">//Si fue un éxito hacemos commit</span></div>
<div class="line"><span class="lineno">  214</span>            $pdo-&gt;commit();</div>
<div class="line"><span class="lineno">  215</span>       }</div>
<div class="line"><span class="lineno">  216</span>       <span class="keywordflow">catch</span> (\PDOException $pdoError){</div>
<div class="line"><span class="lineno">  217</span>            $pdo-&gt;rollBack();</div>
<div class="line"><span class="lineno">  218</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  219</span>        }</div>
<div class="line"><span class="lineno">  220</span>        <span class="keywordflow">catch</span>(\Exception $error){</div>
<div class="line"><span class="lineno">  221</span>            $pdo-&gt;rollBack();</div>
<div class="line"><span class="lineno">  222</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  223</span>        }</div>
<div class="line"><span class="lineno">  224</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  225</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8d4d8d2865cb5ef895d17009cca3c608" name="a8d4d8d2865cb5ef895d17009cca3c608"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d4d8d2865cb5ef895d17009cca3c608">&#9670;&nbsp;</a></span>crearProducto()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::crearProducto </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  159</span>                                   { <span class="comment">// producto o accesorio</span></div>
<div class="line"><span class="lineno">  160</span>        </div>
<div class="line"><span class="lineno">  161</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8f9120bde72c498088b79607ac02e528" name="a8f9120bde72c498088b79607ac02e528"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f9120bde72c498088b79607ac02e528">&#9670;&nbsp;</a></span>editarPartida()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::editarPartida </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datosPartida</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Guarda los nuevos datos de la partida</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$datosPartida</td><td>Datos a insertar</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>void No devuelve nada </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  265</span>                                                {</div>
<div class="line"><span class="lineno">  266</span>        <span class="comment">//Validamos los campos</span></div>
<div class="line"><span class="lineno">  267</span>        $this-&gt;validarCamposForm($datosPartida);</div>
<div class="line"><span class="lineno">  268</span>        <span class="comment">//Instanciamos bd</span></div>
<div class="line"><span class="lineno">  269</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  270</span>        <span class="comment">//Creamos la sentencia</span></div>
<div class="line"><span class="lineno">  271</span>        $sentencia = <span class="stringliteral">&quot;UPDATE partidas as P SET  plazas_min = :plazas_min, plazas_totales = :plazas_totales, fecha = :fecha, hora_inicio = :hora_inicio, duracion = :duracion, director_partida = :director_partida, juego_partida = :juego_partida WHERE id_partida = :id_partida&quot;</span>;</div>
<div class="line"><span class="lineno">  272</span>        <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;agregarModificarDatosBDNum($sentencia, $datosPartida);</div>
<div class="line"><span class="lineno">  273</span>        <span class="comment">//Comprobamos que no diera error</span></div>
<div class="line"><span class="lineno">  274</span>        <span class="keywordflow">if</span>(is_string(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>) &amp;&amp; stripos(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>, <span class="stringliteral">&quot;error&quot;</span>) !== <span class="keyword">false</span>){</div>
<div class="line"><span class="lineno">  275</span>            <span class="keywordflow">throw</span> new \PDOException(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>);</div>
<div class="line"><span class="lineno">  276</span>        }</div>
<div class="line"><span class="lineno">  277</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aca09c4a5be65b23e35155fcdc13da941" name="aca09c4a5be65b23e35155fcdc13da941"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca09c4a5be65b23e35155fcdc13da941">&#9670;&nbsp;</a></span>editarProducto()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::editarProducto </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  153</span>                                    {</div>
<div class="line"><span class="lineno">  154</span>        </div>
<div class="line"><span class="lineno">  155</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3bf032ae9b2504b0194bbff8c73eeb08" name="a3bf032ae9b2504b0194bbff8c73eeb08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bf032ae9b2504b0194bbff8c73eeb08">&#9670;&nbsp;</a></span>eliminarPartida()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::eliminarPartida </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$idPartida</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Elimina la partida y todas las tuplas asociadas a ella</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$idPartida</td><td>Id de la partida a eliminar</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>void No devuelve nada </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  286</span>                                               {</div>
<div class="line"><span class="lineno">  287</span>        <span class="comment">//Validamos los cmapos</span></div>
<div class="line"><span class="lineno">  288</span>        $this-&gt;validarCamposForm($idPartida);</div>
<div class="line"><span class="lineno">  289</span>        <span class="comment">//instanciamos bd</span></div>
<div class="line"><span class="lineno">  290</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  291</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  292</span>            <span class="comment">//Iniciamos la transacción manual</span></div>
<div class="line"><span class="lineno">  293</span>            $pdo = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;iniciarTransaccionManual();</div>
<div class="line"><span class="lineno">  294</span>            <span class="comment">//Convertimos el id a int</span></div>
<div class="line"><span class="lineno">  295</span>            $idPartida = [<span class="stringliteral">&quot;id_partida&quot;</span> =&gt; intval($idPartida)];</div>
<div class="line"><span class="lineno">  296</span>            <span class="comment">//Cogemos los datos de la partida</span></div>
<div class="line"><span class="lineno">  297</span>            $sentenciaPartida = <span class="stringliteral">&quot;SELECT fecha from partidas WHERE id_partida = :id_partida;&quot;</span>;</div>
<div class="line"><span class="lineno">  298</span>            $pdoStatement = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;recuperarDatosBDNum($sentenciaPartida, $idPartida);</div>
<div class="line"><span class="lineno">  299</span>            <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">  300</span>                <span class="keywordflow">throw</span> new \PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  301</span>            }</div>
<div class="line"><span class="lineno">  302</span>            $fechaPartida = $pdoStatement-&gt;fetch(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  303</span>            unset($pdoStatement);</div>
<div class="line"><span class="lineno">  304</span>            <span class="comment">//Cogemos los correos que estean asociados a esa</span></div>
<div class="line"><span class="lineno">  305</span>            $sentenciaDatos = <span class="stringliteral">&quot;SELECT usuario FROM usuarios_partidas WHERE partida = :id_partida;&quot;</span>;</div>
<div class="line"><span class="lineno">  306</span>            $pdoStatement = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;recuperarDatosBDNum($sentenciaDatos, $idPartida);</div>
<div class="line"><span class="lineno">  307</span>            <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">  308</span>                <span class="keywordflow">throw</span> new \PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  309</span>            }</div>
<div class="line"><span class="lineno">  310</span>            <span class="comment">//Creamos la sentencia</span></div>
<div class="line"><span class="lineno">  311</span>            $sentencia2 = <span class="stringliteral">&quot;DELETE FROM usuarios_partidas WHERE partida = :id_partida&quot;</span>;</div>
<div class="line"><span class="lineno">  312</span>            $sentencia = <span class="stringliteral">&quot;DELETE FROM partidas WHERE id_partida = :id_partida&quot;</span>;</div>
<div class="line"><span class="lineno">  313</span>            $sentencias = [$sentencia2, $sentencia];</div>
<div class="line"><span class="lineno">  314</span>            <span class="keywordflow">foreach</span>($sentencias as $sentencia) {</div>
<div class="line"><span class="lineno">  315</span>                <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;agregarModificarDatosBDNum($sentencia, $idPartida, $pdo);</div>
<div class="line"><span class="lineno">  316</span>                <span class="comment">//Comprobamos que no diera error</span></div>
<div class="line"><span class="lineno">  317</span>                <span class="keywordflow">if</span>(is_string(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>) &amp;&amp; stripos(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>, <span class="stringliteral">&quot;error&quot;</span>) !== <span class="keyword">false</span>){</div>
<div class="line"><span class="lineno">  318</span>                    <span class="keywordflow">throw</span> new \PDOException(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>);</div>
<div class="line"><span class="lineno">  319</span>                }</div>
<div class="line"><span class="lineno">  320</span>            }</div>
<div class="line"><span class="lineno">  321</span>            <span class="comment">//Si llegamos hasta aquí es que no hubo ningún error asique Enviamos el correo a cada uno de las personas</span></div>
<div class="line"><span class="lineno">  322</span>            <a class="code hl_variable" href="class_usuarios_1_1_usuario.html#a412d5f518a387e35e7a367fd0a7c330d">$email</a> = <span class="keyword">new</span> mail();</div>
<div class="line"><span class="lineno">  323</span>            <span class="keywordflow">while</span>($tupla = $pdoStatement-&gt;fetch(\PDO::FETCH_ASSOC)){</div>
<div class="line"><span class="lineno">  324</span>                $correoEnviado = <a class="code hl_variable" href="class_usuarios_1_1_usuario.html#a412d5f518a387e35e7a367fd0a7c330d">$email</a>-&gt;enviarCorreos($tupla[<span class="stringliteral">&quot;usuario&quot;</span>], <span class="stringliteral">&quot;cancelar partida&quot;</span>, $fechaPartida);</div>
<div class="line"><span class="lineno">  325</span>                <span class="keywordflow">if</span>($correoEnviado !== <span class="keyword">true</span>) {</div>
<div class="line"><span class="lineno">  326</span>                    <span class="keywordflow">throw</span> new \Exception($correoEnviado);</div>
<div class="line"><span class="lineno">  327</span>                }</div>
<div class="line"><span class="lineno">  328</span>            }</div>
<div class="line"><span class="lineno">  329</span>            $pdo-&gt;commit();</div>
<div class="line"><span class="lineno">  330</span>        }</div>
<div class="line"><span class="lineno">  331</span>        <span class="keywordflow">catch</span> (\PDOException $pdoError){</div>
<div class="line"><span class="lineno">  332</span>            $pdo-&gt;rollBack();</div>
<div class="line"><span class="lineno">  333</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  334</span>        }</div>
<div class="line"><span class="lineno">  335</span>        <span class="keywordflow">catch</span>(\Exception $error){</div>
<div class="line"><span class="lineno">  336</span>            $pdo-&gt;rollBack();</div>
<div class="line"><span class="lineno">  337</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  338</span>        }</div>
<div class="line"><span class="lineno">  339</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a7bee6c23d98191f28442ce035c9c977d" name="a7bee6c23d98191f28442ce035c9c977d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7bee6c23d98191f28442ce035c9c977d">&#9670;&nbsp;</a></span>eliminarProducto()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::eliminarProducto </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  156</span>                                      {</div>
<div class="line"><span class="lineno">  157</span>        </div>
<div class="line"><span class="lineno">  158</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad74a3a8b077250954f7512bf6a56721b" name="ad74a3a8b077250954f7512bf6a56721b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad74a3a8b077250954f7512bf6a56721b">&#9670;&nbsp;</a></span>filtarPartidas()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::filtarPartidas </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datosPartida</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Filtra las partidas que muestra al administrador</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$datosPartida</td><td>Array con los datos a filtrar de la partida</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>mixed O el error en string o un objeto </dd></dl>

<p>Reimplementado de <a class="el" href="class_usuarios_1_1_usuario.html#abc69da0200ab80f3869621bba5218540">Usuarios\Usuario</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  512</span>                                                  {</div>
<div class="line"><span class="lineno">  513</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  514</span>            <span class="comment">//Validamos los campos</span></div>
<div class="line"><span class="lineno">  515</span>            $this-&gt;validarCamposForm($datosPartida);</div>
<div class="line"><span class="lineno">  516</span>            <span class="comment">//Comprobamos las fechas</span></div>
<div class="line"><span class="lineno">  517</span>            $fecha1 = $datosPartida[<span class="stringliteral">&quot;fecha&quot;</span>] ?? <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">  518</span>            $fecha2 = $datosPartida[<span class="stringliteral">&quot;fechaFin&quot;</span>] ?? <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">  519</span>            $fechas = $this-&gt;<a class="code hl_function" href="class_usuarios_1_1_usuario.html#ae3e1becc984b8ac96f4b64727127c25d">comprobarFechas</a>($fecha1, $fecha2, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  520</span>            <span class="comment">//Parametros que le vamos a pasar para filtrar los datos</span></div>
<div class="line"><span class="lineno">  521</span>            $datosFiltrado = [];</div>
<div class="line"><span class="lineno">  522</span>            <span class="comment">//Sentencias</span></div>
<div class="line"><span class="lineno">  523</span>            <span class="comment">//Sentencia para contar el número de páginas es como la normal pero contando las tuplas sin limitar</span></div>
<div class="line"><span class="lineno">  524</span>            $sentenciaNumPag = <span class="stringliteral">&quot;SELECT COUNT(P.id_partida) as num_pag from partidas as P INNER JOIN productos as PR ON P.juego_partida = PR.id_producto&quot;</span>;</div>
<div class="line"><span class="lineno">  525</span>            <span class="comment">//Sentenica para los datos</span></div>
<div class="line"><span class="lineno">  526</span>            $sentencia = <span class="stringliteral">&quot;SELECT P.id_partida, PR.nombre as juego_partida, P.fecha,  CONCAT(P.plazas_min, &#39;-&#39;, P.plazas_totales) as num_jugadores, P.director_partida  from partidas as P INNER JOIN productos as PR ON P.juego_partida = PR.id_producto&quot;</span>;</div>
<div class="line"><span class="lineno">  527</span>            <span class="comment">//Compruebo si se aplicó algún filtro</span></div>
<div class="line"><span class="lineno">  528</span>            <span class="keywordflow">if</span>(!empty($datosPartida[<span class="stringliteral">&quot;juego_partida&quot;</span>])){</div>
<div class="line"><span class="lineno">  529</span>                $sentenciaNumPag .= <span class="stringliteral">&quot; AND (PR.nombre LIKE :juego_partida)&quot;</span>;</div>
<div class="line"><span class="lineno">  530</span>                $sentencia .= <span class="stringliteral">&quot; AND (PR.nombre LIKE :juego_partida)&quot;</span>;</div>
<div class="line"><span class="lineno">  531</span>                <span class="comment">//Convertimos el elemento a int ya que como viene de  JS viene como cadena</span></div>
<div class="line"><span class="lineno">  532</span>                $datosFiltrado[<span class="stringliteral">&quot;juego_partida&quot;</span>] = <span class="stringliteral">&quot;%&quot;</span> . $datosPartida[<span class="stringliteral">&quot;juego_partida&quot;</span>] . <span class="stringliteral">&quot;%&quot;</span>;</div>
<div class="line"><span class="lineno">  533</span>            }</div>
<div class="line"><span class="lineno">  534</span>            <span class="comment">//Compruebo cuantas fechas tengo</span></div>
<div class="line"><span class="lineno">  535</span>            <span class="keywordflow">if</span>(count($fechas) == 2) {</div>
<div class="line"><span class="lineno">  536</span>                $sentenciaNumPag .= <span class="stringliteral">&quot; AND (DATE(P.fecha) BETWEEN :fechaIni AND :fechaFin)&quot;</span>;</div>
<div class="line"><span class="lineno">  537</span>                $sentencia .= <span class="stringliteral">&quot; AND (DATE(P.fecha) BETWEEN :fechaIni AND :fechaFin)&quot;</span>;</div>
<div class="line"><span class="lineno">  538</span>                $datosFiltrado[<span class="stringliteral">&quot;fechaIni&quot;</span>] = $fechas[0];</div>
<div class="line"><span class="lineno">  539</span>                $datosFiltrado[<span class="stringliteral">&quot;fechaFin&quot;</span>] = $fechas[1];</div>
<div class="line"><span class="lineno">  540</span>            }</div>
<div class="line"><span class="lineno">  541</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(count($fechas) == 1){</div>
<div class="line"><span class="lineno">  542</span>                $sentenciaNumPag .= <span class="stringliteral">&quot; AND (DATE(P.fecha) &gt;= :fechaIni)&quot;</span>;</div>
<div class="line"><span class="lineno">  543</span>                $sentencia .= <span class="stringliteral">&quot; AND (DATE(P.fecha) &gt;= :fechaIni)&quot;</span>;</div>
<div class="line"><span class="lineno">  544</span>                $datosFiltrado[<span class="stringliteral">&quot;fechaIni&quot;</span>] = $fechas[0];</div>
<div class="line"><span class="lineno">  545</span>            }</div>
<div class="line"><span class="lineno">  546</span>            <span class="comment">//Calculamos el número de páginas</span></div>
<div class="line"><span class="lineno">  547</span>            $numPag = $this-&gt;<a class="code hl_function" href="class_usuarios_1_1_usuario.html#acc070103af69847d4e5db51084b9b690">calcularNumPag</a>($sentenciaNumPag, $datosFiltrado,  intval($datosPartida[<span class="stringliteral">&quot;limite&quot;</span>]));</div>
<div class="line"><span class="lineno">  548</span>            <span class="comment">//Añadimos el límite para la sentencia que recupera los datos</span></div>
<div class="line"><span class="lineno">  549</span>            $sentencia .= <span class="stringliteral">&quot; LIMIT :pagina, :limite ;&quot;</span>;</div>
<div class="line"><span class="lineno">  550</span>            <span class="comment">//Convertimos los elementos a int ya que como viene de  JS viene como cadena</span></div>
<div class="line"><span class="lineno">  551</span>            $datosFiltrado[<span class="stringliteral">&quot;pagina&quot;</span>] = intval($datosPartida[<span class="stringliteral">&quot;pagina&quot;</span>]);</div>
<div class="line"><span class="lineno">  552</span>            $datosFiltrado[<span class="stringliteral">&quot;limite&quot;</span>] = intval($datosPartida[<span class="stringliteral">&quot;limite&quot;</span>]); </div>
<div class="line"><span class="lineno">  553</span>            <span class="comment">//Instanciamos la bd</span></div>
<div class="line"><span class="lineno">  554</span>            <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  555</span>            <span class="comment">//Envio la petición</span></div>
<div class="line"><span class="lineno">  556</span>            $pdoStatement = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;recuperarDatosBDNum($sentencia, $datosFiltrado);</div>
<div class="line"><span class="lineno">  557</span>            <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">  558</span>                <span class="keywordflow">throw</span> new \PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  559</span>            }</div>
<div class="line"><span class="lineno">  560</span>            <span class="comment">//Cogemos los valores con fetchAll ya que los tenemos limitados, como mucho devuelve 7 tuplas</span></div>
<div class="line"><span class="lineno">  561</span>            $tuplas = $pdoStatement-&gt;fetchAll(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  562</span>            $respuesta = [<span class="stringliteral">&quot;numPag&quot;</span> =&gt; $numPag, <span class="stringliteral">&quot;partidas&quot;</span> =&gt; $tuplas];</div>
<div class="line"><span class="lineno">  563</span>        }</div>
<div class="line"><span class="lineno">  564</span>        <span class="keywordflow">catch</span>(\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  565</span>            $respuesta = <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getCode() . <span class="stringliteral">&quot; :&quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  566</span>        }</div>
<div class="line"><span class="lineno">  567</span>        <span class="keywordflow">catch</span>(\Exception $error){</div>
<div class="line"><span class="lineno">  568</span>            $respuesta = <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot; :&quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  569</span>        }</div>
<div class="line"><span class="lineno">  570</span>        <span class="keywordflow">return</span> $respuesta;</div>
<div class="line"><span class="lineno">  571</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa03006530b93e43fc9512f5ac4b2dd69" name="aa03006530b93e43fc9512f5ac4b2dd69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa03006530b93e43fc9512f5ac4b2dd69">&#9670;&nbsp;</a></span>filtrarReservas()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::filtrarReservas </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datosPartida</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  444</span>                                                   {</div>
<div class="line"><span class="lineno">  445</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  446</span>            <span class="comment">//Validamos los campos</span></div>
<div class="line"><span class="lineno">  447</span>            $this-&gt;validarCamposForm($datosPartida);</div>
<div class="line"><span class="lineno">  448</span>            <span class="comment">//Comprobamos las fechas</span></div>
<div class="line"><span class="lineno">  449</span>            $fecha1 = $datosPartida[<span class="stringliteral">&quot;fecha&quot;</span>] ?? <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">  450</span>            $fecha2 = $datosPartida[<span class="stringliteral">&quot;fechaFin&quot;</span>] ?? <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">  451</span>            $fechas = $this-&gt;<a class="code hl_function" href="class_usuarios_1_1_usuario.html#ae3e1becc984b8ac96f4b64727127c25d">comprobarFechas</a>($fecha1, $fecha2, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  452</span>            <span class="comment">//Parametros que le vamos a pasar para filtrar los datos</span></div>
<div class="line"><span class="lineno">  453</span>            $datosFiltrado = [];</div>
<div class="line"><span class="lineno">  454</span>            <span class="comment">//Sentencias</span></div>
<div class="line"><span class="lineno">  455</span>            <span class="comment">//Sentencia para contar el número de páginas es como la normal pero contando las tuplas sin limitar</span></div>
<div class="line"><span class="lineno">  456</span>            $sentenciaNumPag = <span class="stringliteral">&quot;SELECT COUNT(UP.partida) as num_pag FROM usuarios_partidas as UP&quot;</span>;</div>
<div class="line"><span class="lineno">  457</span>            <span class="comment">//Sentenica para los datos</span></div>
<div class="line"><span class="lineno">  458</span>            $sentencia = <span class="stringliteral">&quot;SELECT UP.partida as id_partida, UP.usuario, P.fecha, PR.nombre, P.director_partida  FROM usuarios_partidas as UP INNER JOIN partidas as P ON UP.reservada = 0 AND UP.partida = P.id_partida INNER JOIN productos as PR ON P.juego_partida = PR.id_producto&quot;</span>;</div>
<div class="line"><span class="lineno">  459</span>            <span class="comment">//Compruebo si se aplicó algún filtro</span></div>
<div class="line"><span class="lineno">  460</span>            <span class="keywordflow">if</span>(!empty($datosPartida[<span class="stringliteral">&quot;usuario&quot;</span>])){</div>
<div class="line"><span class="lineno">  461</span>                $sentenciaNumPag .= <span class="stringliteral">&quot; AND (UP.usuario LIKE :usuario)&quot;</span>;</div>
<div class="line"><span class="lineno">  462</span>                $sentencia .= <span class="stringliteral">&quot; AND (UP.usuario LIKE :usuario)&quot;</span>;</div>
<div class="line"><span class="lineno">  463</span>                <span class="comment">//Convertimos el elemento a int ya que como viene de  JS viene como cadena</span></div>
<div class="line"><span class="lineno">  464</span>                $datosFiltrado[<span class="stringliteral">&quot;usuario&quot;</span>] = <span class="stringliteral">&quot;%&quot;</span> . $datosPartida[<span class="stringliteral">&quot;usuario&quot;</span>] . <span class="stringliteral">&quot;%&quot;</span>;</div>
<div class="line"><span class="lineno">  465</span>            }</div>
<div class="line"><span class="lineno">  466</span>            <span class="comment">//Compruebo cuantas fechas tengo</span></div>
<div class="line"><span class="lineno">  467</span>            <span class="keywordflow">if</span>(count($fechas) == 2) {</div>
<div class="line"><span class="lineno">  468</span>                $sentenciaNumPag .= <span class="stringliteral">&quot; AND (DATE(P.fecha) BETWEEN :fechaIni AND :fechaFin)&quot;</span>;</div>
<div class="line"><span class="lineno">  469</span>                $sentencia .= <span class="stringliteral">&quot; AND (DATE(P.fecha) BETWEEN :fechaIni AND :fechaFin)&quot;</span>;</div>
<div class="line"><span class="lineno">  470</span>                $datosFiltrado[<span class="stringliteral">&quot;fechaIni&quot;</span>] = $fechas[0];</div>
<div class="line"><span class="lineno">  471</span>                $datosFiltrado[<span class="stringliteral">&quot;fechaFin&quot;</span>] = $fechas[1];</div>
<div class="line"><span class="lineno">  472</span>            }</div>
<div class="line"><span class="lineno">  473</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(count($fechas) == 1){</div>
<div class="line"><span class="lineno">  474</span>                $sentenciaNumPag .= <span class="stringliteral">&quot; AND (DATE(P.fecha) &gt;= :fechaIni)&quot;</span>;</div>
<div class="line"><span class="lineno">  475</span>                $sentencia .= <span class="stringliteral">&quot; AND (DATE(P.fecha) &gt;= :fechaIni)&quot;</span>;</div>
<div class="line"><span class="lineno">  476</span>                $datosFiltrado[<span class="stringliteral">&quot;fechaIni&quot;</span>] = $fechas[0];</div>
<div class="line"><span class="lineno">  477</span>            }</div>
<div class="line"><span class="lineno">  478</span>            <span class="comment">//Calculamos el número de páginas</span></div>
<div class="line"><span class="lineno">  479</span>            $numPag = $this-&gt;<a class="code hl_function" href="class_usuarios_1_1_usuario.html#acc070103af69847d4e5db51084b9b690">calcularNumPag</a>($sentenciaNumPag, $datosFiltrado,  intval($datosPartida[<span class="stringliteral">&quot;limite&quot;</span>]));</div>
<div class="line"><span class="lineno">  480</span>            <span class="comment">//Añadimos el límite para la sentencia que recupera los datos</span></div>
<div class="line"><span class="lineno">  481</span>            $sentencia .= <span class="stringliteral">&quot; LIMIT :pagina, :limite ;&quot;</span>;</div>
<div class="line"><span class="lineno">  482</span>            <span class="comment">//Convertimos los elementos a int ya que como viene de  JS viene como cadena</span></div>
<div class="line"><span class="lineno">  483</span>            $datosFiltrado[<span class="stringliteral">&quot;pagina&quot;</span>] = intval($datosPartida[<span class="stringliteral">&quot;pagina&quot;</span>]);</div>
<div class="line"><span class="lineno">  484</span>            $datosFiltrado[<span class="stringliteral">&quot;limite&quot;</span>] = intval($datosPartida[<span class="stringliteral">&quot;limite&quot;</span>]); </div>
<div class="line"><span class="lineno">  485</span>            <span class="comment">//Instanciamos la bd</span></div>
<div class="line"><span class="lineno">  486</span>            <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  487</span>            <span class="comment">//Envio la petición</span></div>
<div class="line"><span class="lineno">  488</span>            $pdoStatement = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;recuperarDatosBDNum($sentencia, $datosFiltrado);</div>
<div class="line"><span class="lineno">  489</span>            <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">  490</span>                <span class="keywordflow">throw</span> new \PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  491</span>            }</div>
<div class="line"><span class="lineno">  492</span>            <span class="comment">//Cogemos los valores con fetchAll ya que los tenemos limitados, como mucho devuelve 7 tuplas</span></div>
<div class="line"><span class="lineno">  493</span>            $tuplas = $pdoStatement-&gt;fetchAll(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  494</span>            $respuesta = [<span class="stringliteral">&quot;numPag&quot;</span> =&gt; $numPag, <span class="stringliteral">&quot;reservas&quot;</span> =&gt; $tuplas];</div>
<div class="line"><span class="lineno">  495</span>        }</div>
<div class="line"><span class="lineno">  496</span>        <span class="keywordflow">catch</span>(\PDOException $pdoError) {</div>
<div class="line"><span class="lineno">  497</span>            $respuesta = <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getCode() . <span class="stringliteral">&quot; :&quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  498</span>        }</div>
<div class="line"><span class="lineno">  499</span>        <span class="keywordflow">catch</span>(\Exception $error){</div>
<div class="line"><span class="lineno">  500</span>            $respuesta = <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getCode() . <span class="stringliteral">&quot; :&quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  501</span>        }</div>
<div class="line"><span class="lineno">  502</span>        <span class="keywordflow">return</span> $respuesta;</div>
<div class="line"><span class="lineno">  503</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3a6b0b33728a95357c340ce21091ee2d" name="a3a6b0b33728a95357c340ce21091ee2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a6b0b33728a95357c340ce21091ee2d">&#9670;&nbsp;</a></span>rechazarSolicitudPartida()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::rechazarSolicitudPartida </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$datosReserva</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Elimina la solicitud de reserva</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$datosReserva</td><td>Array con los datos a agregar (id_partida e usuario)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>void No devuelve nada </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  400</span>                                                            {</div>
<div class="line"><span class="lineno">  401</span>        $this-&gt;validarCamposForm($datosReserva);</div>
<div class="line"><span class="lineno">  402</span>        <span class="comment">//Instanciamos bd</span></div>
<div class="line"><span class="lineno">  403</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  404</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  405</span>            <span class="comment">//Iniciamos una transacción manual</span></div>
<div class="line"><span class="lineno">  406</span>            $pdo = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;iniciarTransaccionManual();</div>
<div class="line"><span class="lineno">  407</span>            <span class="comment">//Relizamos una consulta para coger los datos de la partida</span></div>
<div class="line"><span class="lineno">  408</span>            $sentencia = <span class="stringliteral">&quot;SELECT P.fecha, P.hora_inicio, P.duracion, PR.nombre as juego FROM partidas AS P INNER JOIN productos AS PR ON P.id_partida = :id_partida AND P.juego_partida = PR.id_producto;&quot;</span>;</div>
<div class="line"><span class="lineno">  409</span>            $pdoStatement = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;recuperarDatosBDNum($sentencia, [<span class="stringliteral">&quot;id_partida&quot;</span> =&gt; $datosReserva[<span class="stringliteral">&quot;id_partida&quot;</span>]], $pdo);</div>
<div class="line"><span class="lineno">  410</span>            <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">  411</span>                <span class="keywordflow">throw</span> new \PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  412</span>            }</div>
<div class="line"><span class="lineno">  413</span>            <a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a> = $pdoStatement-&gt;fetch(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  414</span>            <span class="keywordflow">if</span>(empty(<a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a>)){</div>
<div class="line"><span class="lineno">  415</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&quot;No existe esa partida&quot;</span>);</div>
<div class="line"><span class="lineno">  416</span>            }</div>
<div class="line"><span class="lineno">  417</span>            <span class="comment">//Sentencia para elimina de la BD</span></div>
<div class="line"><span class="lineno">  418</span>            $sentencia = <span class="stringliteral">&quot;DELETE FROM usuarios_partidas WHERE partida = :id_partida AND usuario = :usuario;&quot;</span>;</div>
<div class="line"><span class="lineno">  419</span>            <span class="comment">//Convertimos el id  a int ya que como viene de json viene como string</span></div>
<div class="line"><span class="lineno">  420</span>            $datosReserva[<span class="stringliteral">&quot;id_partida&quot;</span>] = intval($datosReserva[<span class="stringliteral">&quot;id_partida&quot;</span>]);</div>
<div class="line"><span class="lineno">  421</span>            <a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a> = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;agregarModificarDatosBDNum($sentencia, $datosReserva);</div>
<div class="line"><span class="lineno">  422</span>            <span class="keywordflow">if</span>(is_string(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>) &amp;&amp; stripos(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>, <span class="stringliteral">&quot;error&quot;</span>) !== <span class="keyword">false</span>){</div>
<div class="line"><span class="lineno">  423</span>                <span class="keywordflow">throw</span> new \PDOException(<a class="code hl_variable" href="suscripciones_8php.html#a06face0ef35c41554d8f4fe115363f58">$resultado</a>);</div>
<div class="line"><span class="lineno">  424</span>            }</div>
<div class="line"><span class="lineno">  425</span>            <span class="comment">//Si llegó hasta aquí es que se realizó con éxito por lo que enviamos el correo</span></div>
<div class="line"><span class="lineno">  426</span>            <a class="code hl_variable" href="class_usuarios_1_1_usuario.html#a412d5f518a387e35e7a367fd0a7c330d">$email</a> = <span class="keyword">new</span> mail();</div>
<div class="line"><span class="lineno">  427</span>            <span class="comment">//Añadimos a datos que ha sido rechazada</span></div>
<div class="line"><span class="lineno">  428</span>            <a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a>[<span class="stringliteral">&quot;rechazada&quot;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  429</span>            $correoEnviado = <a class="code hl_variable" href="class_usuarios_1_1_usuario.html#a412d5f518a387e35e7a367fd0a7c330d">$email</a>-&gt;enviarCorreos($datosReserva[<span class="stringliteral">&quot;usuario&quot;</span>], <span class="stringliteral">&quot;reserva&quot;</span>, <a class="code hl_variable" href="registro_8php.html#a8a19dd5c98c023a74c45bfbed55e9674">$datos</a>);</div>
<div class="line"><span class="lineno">  430</span>            <span class="keywordflow">if</span>($correoEnviado !== <span class="keyword">true</span>) {</div>
<div class="line"><span class="lineno">  431</span>                <span class="keywordflow">throw</span> new \Exception($correoEnviado);</div>
<div class="line"><span class="lineno">  432</span>            }</div>
<div class="line"><span class="lineno">  433</span>        }</div>
<div class="line"><span class="lineno">  434</span>        <span class="keywordflow">catch</span> (\PDOException $pdoError){</div>
<div class="line"><span class="lineno">  435</span>            $pdo-&gt;rollBack();</div>
<div class="line"><span class="lineno">  436</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $pdoError-&gt;getMessage();</div>
<div class="line"><span class="lineno">  437</span>        }</div>
<div class="line"><span class="lineno">  438</span>        <span class="keywordflow">catch</span>(\Exception $error){</div>
<div class="line"><span class="lineno">  439</span>            $pdo-&gt;rollBack();</div>
<div class="line"><span class="lineno">  440</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error &quot;</span> . $error-&gt;getMessage();</div>
<div class="line"><span class="lineno">  441</span>        }</div>
<div class="line"><span class="lineno">  442</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aea36409b785e62cc80586e11979d52d4" name="aea36409b785e62cc80586e11979d52d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea36409b785e62cc80586e11979d52d4">&#9670;&nbsp;</a></span>recuperarDatosActualesPartida()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Usuarios\Administrador::recuperarDatosActualesPartida </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$idPartida</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Devuelve los datos de la partida a editar</p>
<dl class="params"><dt>Parámetros</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$idPartida</td><td>ID de la partida</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Devuelve</dt><dd>mixed Devuelve array con los datos o una Excepción </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  234</span>                                                             {</div>
<div class="line"><span class="lineno">  235</span>        <span class="comment">//Primero validamos los datos que nos pasaron en datosPartida</span></div>
<div class="line"><span class="lineno">  236</span>        $this-&gt;validarCamposForm($idPartida);</div>
<div class="line"><span class="lineno">  237</span>        <span class="comment">//Instanciamos la BD</span></div>
<div class="line"><span class="lineno">  238</span>        <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a> = <span class="keyword">new</span> bd();</div>
<div class="line"><span class="lineno">  239</span>        <span class="comment">//Creamos la sentencia</span></div>
<div class="line"><span class="lineno">  240</span>        $sentencia = <span class="stringliteral">&quot;SELECT P.juego_partida, PR.nombre as nombre_juego, P.fecha, P.plazas_min, P.plazas_totales, P.hora_inicio, P.duracion, P.director_partida  FROM partidas AS P INNER JOIN productos as PR ON P.juego_partida = PR.id_producto WHERE id_partida = :id_partida&quot;</span>;</div>
<div class="line"><span class="lineno">  241</span>        <span class="comment">//Guardamos el id en un array ya que es lo que pide el método y lo convertimos a int ya que al venir de JSOn viene como string</span></div>
<div class="line"><span class="lineno">  242</span>        $datosAsignar = [<span class="stringliteral">&quot;id_partida&quot;</span> =&gt; intval($idPartida)];</div>
<div class="line"><span class="lineno">  243</span>        <span class="comment">//Mandamos la sentencia para que se ejecute</span></div>
<div class="line"><span class="lineno">  244</span>        $pdoStatement = <a class="code hl_variable" href="caja_sorpresa_8php.html#acc3591d1c0945e5b934207901d1e06c0">$bd</a>-&gt;recuperarDatosBDNum($sentencia, $datosAsignar);</div>
<div class="line"><span class="lineno">  245</span>        <span class="comment">//Comprobamos si nos devolvió un $pdoStatement</span></div>
<div class="line"><span class="lineno">  246</span>        <span class="keywordflow">if</span>(!$pdoStatement instanceof \PDOStatement){</div>
<div class="line"><span class="lineno">  247</span>            <span class="keywordflow">throw</span> new \PDOException($pdoStatement);</div>
<div class="line"><span class="lineno">  248</span>        }</div>
<div class="line"><span class="lineno">  249</span>        <span class="comment">//Hacemos fetch con los datos, como el id es único sólo hacemos un fetch</span></div>
<div class="line"><span class="lineno">  250</span>        $datosPartida = $pdoStatement-&gt;fetch(\PDO::FETCH_ASSOC);</div>
<div class="line"><span class="lineno">  251</span>        <span class="comment">//Comprobamos que nos devolviera algo</span></div>
<div class="line"><span class="lineno">  252</span>        <span class="keywordflow">if</span>(!$datosPartida) {</div>
<div class="line"><span class="lineno">  253</span>            <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&quot;No existe esa partida&quot;</span>);</div>
<div class="line"><span class="lineno">  254</span>        }</div>
<div class="line"><span class="lineno">  255</span>        <span class="keywordflow">return</span> $datosPartida;</div>
<div class="line"><span class="lineno">  256</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<hr/>La documentación para esta clase fue generada a partir del siguiente fichero:<ul>
<li>proyecto/php/Usuarios/<a class="el" href="_administrador_8php.html">Administrador.php</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generado el Domingo, 13 de Marzo de 2022 20:14:25 para My Project por&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
